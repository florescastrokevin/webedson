/*
 * Template Customizer
 * Copyright 2018 rokaux
 */
alert('esta cargando el archivo customizer (-no deberia cargar-) ')
jQuery(document).ready(function(t) {
	"use strict";

	/*DEVELOWEB*/
	// updateCestaAjax( 'listCesta' , null , null , null );
	// updateBagShopAjax( 'listBagShop' , null , null , null );
	t.datepicker.regional['es'] = {
     closeText: 'Cerrar',
     prevText: '< Ant',
     nextText: 'Sig >',
     currentText: 'Hoy',
     monthNames: ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'],
     monthNamesShort: ['Ene','Feb','Mar','Abr', 'May','Jun','Jul','Ago','Sep', 'Oct','Nov','Dic'],
     dayNames: ['Domingo', 'Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado'],
     dayNamesShort: ['Dom','Lun','Mar','Mié','Juv','Vie','Sáb'],
     dayNamesMin: ['Do','Lu','Ma','Mi','Ju','Vi','Sá'],
     weekHeader: 'Sm',
     dateFormat: 'dd/mm/yy',
     firstDay: 1,
     isRTL: false,
     showMonthAfterYear: false,
     yearSuffix: ''
     };
    t.datepicker.setDefaults(t.datepicker.regional['es']);
    t(function () {
      t("#fecha-especial-destinatario").datepicker();
    });
	/*t(".addCarrito").on('click',function(){
		alert('hola mundo add carrito');
	    t.ajax({
            type  : "POST",
            url   : _tpl_+"includes/inc.encarrito.php",
            data  : t(this).parent().parent('form.form').serialize(),
          	success: function(data) {
          		// updateCestaAjax( 'listCesta' , null , null , null );
          		// updateBagShopAjax( 'listBagShop' , null , null , null );
          		if(t('.modal-detalle-carrito:visible').length == 0){ 
					t('.modal-detalle-carrito').modal('show');
				}
                t('.modal-detalle-carrito .modal-container').html('');
                t('.modal-detalle-carrito .modal-container').append(data);
                t('.owl-carousel').owlCarousel({
                	nav: false,
                	dots: true,
                	margin: 30,
                	responsive: {
                		0: {
                			items: 1
                		},
                		576: {
                			items: 2
                		},
                		768: {
                			items: 3
                		},
                		991: {
                			items: 4
                		},
                		1200: {
                			items: 4
                		}
                	}
                });
            },
            beforeSend: function(objeto){
            },
            complete: function(){
            }
	    });
	    return false;
	});*/

	/*t(".addCarritoDetalle").on('click',function(){
	    t.ajax({
            type  : "POST",
            url   : _tpl_+"includes/inc.encarrito.php",
            data  : t(this).parent().parent().parent().parent().parent('form.form').serialize(),
          	success: function(data) {
          		// updateCestaAjax( 'listCesta' , null , null , null );
          		// updateBagShopAjax( 'listBagShop' , null , null , null );
          		//Verificamos si un modal esta abierto => 0:el modal no esta visible ; 1: el modal esta visible
          		if(t('.modal-detalle-carrito:visible').length == 0){ 
					t('.modal-detalle-carrito').modal('show');
				}
                t('.modal-detalle-carrito .modal-container').html('');
                t('.modal-detalle-carrito .modal-container').append(data);

                t('.owl-carousel').owlCarousel({
                	nav: false,
                	dots: true,
                	margin: 30,
                	responsive: {0: {items: 1},576: {items: 2},768: {items: 3},991: {items: 4},1200: {items: 4}}
                });
            },
            beforeSend: function(objeto){
            },
            complete: function(){
            	t('#mas_regalos_popup ul#listado_catalogo li').hover(function(){
					t(this)
						.find('.btn_detalle, .btn_compra')
						.stop()
						.fadeIn();		
				},function(){
						t(this)
							.find('.btn_detalle, .btn_compra')
							.hide();
				});
				t('.btn_detalle, .btn_compra').hover(function(){
					t(this)
						.stop()
						.animate({
							opacity:1
						});
				},function(){
					t(this)
						.stop()
						.animate({
							opacity:0.8
						});
				});
				t('#continuarComprando, #verCarrito').css({opacity:0.8});
				t('#continuarComprando, #verCarrito').hover(function(){
					t(this).stop().animate({opacity:1});
				}, function(){
					t(this).stop().animate({opacity:0.8});
				})
            }
	    });
	    return false;
	});*/


	t(".realizarcompraquick").on("click",function(){
        var login = parent.t("#logueadoquick").val();
		if(login==1){
			window.location = _url_web_+'seccion/pedido/envio';
		}else{   
			t('.modal-detalle-carrito').modal('hide');	
			t('.modal-login-rapido').modal('show');
			t("#popup_acceso form input:first").focus();
		}
	});

	t('.close-modal-container').on('click', function(ev) {
	    var modal  = t(this).data('modal');
	    t('.'+modal).modal('hide');
	});
	/*** FIN OPEN MODAL ***/
	/*** INICIO AGREGAR COMPLEMENTO A UN PRODUCTO DETALLE ***/
	t(".btn_anadir").on('click',function(){
		var src = t(this).parent().find('.a_imagen img').attr('src');
		var name_complemento = t(this).parent().find('.nameProd').text();
		var precio = t(this).parent().find('input[name=precio]').val();
		var opcion = t(this).parent().parent().parent().parent().parent().parent().find('input[name=opcion]').val();
		var valor = t(this).parent().find('input[name=id_valor]').val();

		var complemento = '<li id="'+valor+'"><div class="wrap_agregado"><button type="button" class="close eliminar_prod" aria-label="Close"> <span aria-hidden="true">&times;</span> </button> &nbsp;<img src="'+src+'" alt="adicional" />&nbsp;&nbsp;&nbsp;';
		complemento+= '<span>'+name_complemento+' $<b>'+precio+'</b> </span>';
		complemento+= '';		
		complemento+= '</div></li>';
		
		//t("#prod_agregado ul").append(complemento);
		addComplemento(complemento);
		
		var topt = t('form[name=envio_carrito] .opciones_'+valor+'');
		var cantidad_valor = 1;
		
		if( topt.val() != undefined  ){
			cantidad_valor = parseInt(topt.val()) + 1;
			topt.val(cantidad_valor); 
		}else{
			t("form[name=envio_carrito]").append('<input type="hidden" class="opciones_'+valor+'" name="opciones['+valor+']" value="'+cantidad_valor+'">');
		}
		
		
		var precio_temp = 0;
		
		
		t("#prod_agregado ul li").each(function(i, e) {		
			precio_temp += parseFloat(t(this).find('span b').text());	
        });
		
		var precio = t("#detalle_descripcion input[name=precio_producto]").val();
		
		var precio_total = (parseFloat(precio) + parseFloat(precio_temp)) * t("#cant").val();
		
		t("#precio_btn span#precio_temp").text('Precio: $'+precio_total.toFixed(2));
		
		
		if( t("#prod_agregado ul li").length >0){
			t("form[name=envio_carrito] #cant")
		}else{
			
		}
			
		
	});

	function addComplemento(complemento) {
		$("#prod_agregado ul").append(complemento); 
        $('.eliminar_prod').on('click', function() {
            $(this).parent().parent().remove();
			var valor = $(this).parent().attr('id');
			var $opt = $('form[name=envio_carrito] .opciones_'+valor+'');		
			var cantidad_valor = 1;
			if( $opt.val() > 1  ){
				cantidad_valor = parseInt($opt.val()) - 1;
				$opt.val(cantidad_valor); 
			}else{
				$opt.remove();
			}		
			var precio_temp = 0;
			$("#prod_agregado ul li").each(function(i, e) {	
				precio_temp += parseFloat($(this).find('span b').text());				
	        });		
			var precio = $("#detalle_descripcion input[name=precio_producto]").val();		
			var precio_total = (parseFloat(precio) + parseFloat(precio_temp)) * $("#cant").val();		
			$("#precio_btn span#precio_temp").text('Precio: $'+precio_total.toFixed(2));	
        }); 
    }

	t(".eliminar_prod").on('click',function(){
		alert('hola mundo');
		/*
		t(this).parent().remove();
		var valor = t(this).parent().attr('id');
		var topt = t('form[name=envio_carrito] .opciones_'+valor+'');		
		var cantidad_valor = 1;
		
		if( topt.val() > 1  ){
			cantidad_valor = parseInt(topt.val()) - 1;
			topt.val(cantidad_valor); 
		}else{
			topt.remove();
		}		
		var precio_temp = 0;
		t("#prod_agregado ul li").each(function(i, e) {	
			precio_temp += parseFloat(t(this).find('span b').text());				
        });		
		var precio = t("#detalle_descripcion input[name=precio_producto]").val();		
		var precio_total = (parseFloat(precio) + parseFloat(precio_temp)) * t("#cant").val();		
		t("#precio_btn span#precio_temp").text('Precio: t'+precio_total.toFixed(2));	
		*/	
	});

	/*** INICIO AGREGAR COMPLEMENTO A UN PRODUCTO DETALLE ***/


	/*** INICIO MOSTRAR EL MAPA DE UN DISTRITO ***/
    t(".distritoMapa").change(function(){
        id_distrito = t(this).val();
		t.ajax({
			type:"GET",
			cache:false,
			url: _url_web_+"ajax.php?action=newUbicacionMapa",
			data:{ id_distrito: id_distrito},
			success: function(data) {
			//alert(data);				
			  t(".container-envio-mapa").text('');
              t(".container-envio-mapa").html(data);
			}
    	});
		return false;
    });
    /*** FIN MOSTRAR EL MAPA DE UN DISTRITO ***/

	/*** INICIO MODAL ASIGNAR FECHA ESPECIAL ***/
	t('.agregar-fecha-especial').on('click', function(ev) {
	      var nombre_destinatario  = t(this).data('nombres');
	      var id_destinatario  = t(this).data('id-destinatario');
	      var id_cliente  = t(this).data('id-cliente');
	      //alert(id_destinatario);
	      t(".modal-agregar-fecha-especial #id_cliente").val( id_cliente );
	      t(".modal-agregar-fecha-especial #id_destinatario").val( id_destinatario );
	      t(".modal-agregar-fecha-especial .nombre_destinatario").text( nombre_destinatario );
	});

	/*** INICIO MODAL ASIGNAR FECHA ESPECIAL ***/

	t(".buscar_destinatario_envio").autocomplete({
        source: "search.php?tipe=destinatario_envio",
        minLength: 2,
        select: function( event, ui ) {
            cargardatosEnvio(ui.item.id, 1);
        }
  	});
	t("#buscar_destinatario").autocomplete({
        source: "search.php?tipe=destinatario",
        minLength: 2,
        select: function( event, ui ) {
            cargardatos(ui.item.id, 1);
        }
  	});
  	t('.nueva-fecha-especial').on('click', function(ev) {
        tthis = t(this);
		t.ajax({
			type:"GET",
			cache:false,
			url: _url_web_+"ajax.php?action=newClienteDestinatario",
			data: t("#form-add-fechas-especiales").serialize(),
			success: function(data) {				
			  t(".container-body-fechas-especiales").text('');
              t("#id_destinatario,#fecha_especial,#buscar_destinatario,#id_tipo_destinatario,#id_ocasion").val('');
              t(".container-body-fechas-especiales").html(data);
			}
    	});
		return false;
    });

	t('.guardar-fecha-especial').on('click', function(ev) {
        //alert('guardando');
        tthis = t(this);
		t.ajax({
			type:"GET",
			cache:false,
			url: _url_web_+"ajax.php?action=addClienteDestinatario",
			data: t("#form-fechas-especiales").serialize(),
			success: function(data) {				
				t(".container-fechas-especiales").animate({opacity:0},'fast',function(){
				  	t(this).hide(); 
					mensaje  = 'Felicidades se ha registrado correctamente una fecha especial !!!';
				  	t(".container-fechas-especiales").html(mensaje).show().animate({opacity:1},'fast');
				})
			}
    	});
		return false;
    });

    /* cambio de idioma chat */
    setTimeout( function () {
            t('#purechat-name-submit').val('Iniciar Chat');
            t('#purechat-name-submit').attr("onclick", "iniciarChat()");
            t('.please-entername').each(function () {
                    t(this).text("Porfavor ingrese su nombre");
            });
            t('.btn-expand').each(function () {
                    t(this).attr("title", "Expandir");
            });
            t('.btn-collapse').each(function () {
                    t(this).attr("title", "Disminuir");
            });
        }, 2000
    );
		
    setInterval(function () {
 
        t('.purechat-widget-title-link').each(function () {
            if (t(this).text().indexOf("Chatting with") != -1) {
                t(this).text(t(this).text().replace("Chatting with", "Chateando con"));
                t(this).text(t(this).title().replace("Chatting with", "Chateando con"));
            }
            if (t(this).text().indexOf("Chat Closed") != -1) {
                t(this).text(t(this).text().replace("Chat Closed", "Chat cerrado"));
                t(this).text(t(this).title().replace("Chat Closed", "Chat cerrado"));
            }
        });

        t('.purechat-message-note').each(function () {

            // purechat-widget-title-link
            if (t(this).text().indexOf("An operator has not yet connected.") != -1)
                    t(this).text("Un operador te atendera pronto");
            if (t(this).text().indexOf("has joined the chat!") != -1)
                    t(this).text(t(this).text().replace("has joined the chat!", "entró al chat!"));
            if (t(this).text().indexOf("has left the chat!") != -1)
                    t(this).text(t(this).text().replace("has left the chat!", "ha abandonado el chat!"));
            if (t(this).text().indexOf("Thanks for") != -1)
                    t(this).text("Gracias por chatear con nosotros.");
            if (t(this).text().indexOf("An operator will be right with you! Feel free to hide this box and navigate around the site.") != -1)
                    t(this).text(t(this).text().replace("An operator will be right with you! Feel free to hide this box and navigate around the site.", "Hola cómo podemos ayudarte?"));
            t(".purechat-send-form-message").focus();
        });
    }, 100);
	
	// --- BOTON VOLVER PEDIDO --// 
	t("#btn_volver").click(function(){
		history.back(1);
	})
	
	// --- VALIDATION LIBRO RECLAMO --//
	if( t("input[name='persona_natural']:checked").val()==2 ){ // Persona Natural
		t('#razon_social').attr("readonly",false);						
	}else{ // Persona Juridica
		t('#razon_social').attr("readonly",true);						
	}
	
	// --- TIME PICKER , FECHA HORA --- ///
	t('#fecha_hora').datetimepicker('setDate', (new Date()) ).datetimepicker({
		minDate: 0,
		controlType: 'select',
		dateFormat: 'dd/mm/yy',
		timeFormat: "hh:mm tt"
	});	
	//t('#fecha_hora')
	
	// ---  PARA VISA -- //
	t('#verified-visa').click(function(){		
		window.open(t(this).attr('href'),'',"width=606,height=402,resisable=no,menubar=no,titlebar=yes");
		return false;
	})
	
	// ---SELECT ENVIO CESTA ---//
	t("#slc_envio_cesta").change(function(){
		var precio_envio = t(this).find('option:selected').attr('title');		
		t("#flete .porcalcular span").text(precio_envio);
		var total = parseFloat(t("#total_precio #subT").text().replace('t',''));
		
		var tc = parseFloat(t("#cambio").val());
		
		var total_cp = (parseFloat(precio_envio.replace('t','')) + total).toFixed(2) ;
		
		//alert('t'+(parseFloat(precio_envio.replace('t',''))+total).toFixed(2));
			
		t("#numdolar span").html('t'+(parseFloat(precio_envio.replace('t',''))+total).toFixed(2) );
		t("#numsol span").html('S/.'+((parseFloat(precio_envio.replace('t',''))+total)*tc).toFixed(2) );
	})

	// --- VALIDATION VER CARRITO --- //
	var url = window.location.toString();
	var cadena = url.split('?code=');
	var cadena_pago = url.split('?step=');	
	var step = '';	
	if( cadena.length > 0 && cadena[1]!=undefined ){
		step = parseInt(cadena[1]);
	}else if( cadena_pago.length > 0 && cadena_pago[1]!=undefined ){
		step = cadena_pago[1];
	}	
	if(step=='confirmacion' || step > 0){	
		t("#header #carrito").removeClass('move');
	}		
	
	// --- MENU, SUBMENU, FILTROS --- //
	t("#header #carrito").hover(function(e){
		t("#header #nav").css('z-index',1);
		},function(){
		t("#header #nav").css('z-index',2);
	})
	
			
	
	function msieversion(){
      var ua = window.navigator.userAgent
      var msie = ua.indexOf ( "MSIE " )

      if ( msie > 0 ){      // If Internet Explorer, return version number
         return parseInt (ua.substring (msie+5, ua.indexOf (".", msie )))
      }else{                 // If another browser, return 0
         return 0
     }
   }

   t(".ordenar_por").change(function(){
		
		var contenedor = t(this).parent("form");		
		var optorder = t(this).val();		
		var url = document.URL;		
		var busqRegex = /\?q=/;
		var busqRegexo = /&o=/;
		var urlsend = t("#urlq").val();
		if(url.match(busqRegex)){			
			var tmpq = url.split('?q=');			
			if(url.match(busqRegexo)){				
				var tmpqo = url.split('&o=');
				var newurl = tmpqo[0] +'&o='+  optorder;
			}else{
				var newurl = urlsend +'?q='+ tmpq[1] +'&o='+  optorder;
			}		
			location.href = newurl;		
		}else if( optorder == "Seleccione" ){
						
		}else{
			contenedor.submit();
		}		
	});

	// --- DETALLE PRODUCTO --- //
	if(t("#detalle_imagenes ul li").length>1){
		t('#detalle_imagenes ul').bxSlider({
		  pause:10000,
		  pagerCustom: '#detalle_thumbs',
		  controls: false,
		  auto: true
		});
	}

	// --- DETALLE AÑADIR --- //
	if ( t('#agregar_regalo ul li').length > 3 ){
		t('#agregar_regalo ul').bxSlider({
			slideWidth: 180,
			minSlides:3,
			maxSlides:3,
			moveSlides: 1,
			slideMargin: 5,
			pager: false
		});
	}else{
		t('#agregar_regalo ul').width('560').css('margin-left',25);
	}

	t('.btn_anadir, #btn_agregar_carrito').css({opacity:0.8});
	t('.btn_anadir, #btn_agregar_carrito').hover(function(){
		t(this).stop().animate({opacity:1});
	}, function(){
		t(this).stop().animate({opacity:0.8});
	})

	
	// -- SCRIPT ONLY NUMBER -- //
	t(".solo_numero").keydown(function(){
		if ( event.keyCode == 46 || event.keyCode == 8 || event.keyCode == 9 || event.keyCode == 27 || event.keyCode == 13 || 		
		(event.keyCode == 65 && event.ctrlKey === true) || 			
		(event.keyCode >= 35 && event.keyCode <= 39)) {
		 return;
		}
		else {	
		if (event.shiftKey || (event.keyCode < 48 || event.keyCode > 57) && (event.keyCode < 96 || event.keyCode > 105 )) {
		event.preventDefault(); 
		}   
		}
	});	
	
	// -- CANTIDAD DETALLE -- //
	t("#cant").keyup(function(){			
		var precio_temp = 0;
		t("#prod_agregado ul li").each(function(i, e) {			
           precio_temp += parseFloat(t(this).find('span b').text());	
        });
		var precio = t("#detalle_descripcion input[name=precio_producto]").val();		
		var precio_total = (parseFloat(precio) + parseFloat(precio_temp))*t("#cant").val();		
		t("#precio_btn span#precio_temp").text('Precio: t'+precio_total.toFixed(2));		
	})
	
	// -- CANTIDAD FOCUS ---//
	t(".kcarro").focusout(function(e) {
       var cantidad = t(this).val();
	   if(cantidad>0){	
	   	t(this).val(cantidad)
	   }else{
	   	t(this).val('')
	   }
    });
	
	// -- UPDATE CANTIDAD CARRITO --//	
	t(".kcarro").keyup(function(e){
		var cantidad = t(this).val();
		if(cantidad>0){		
			var li = t(this).parent();
			var pu = li.prev().children().children().text().replace('$','');
			var newst = (pu * cantidad).toFixed(2);		

			li.next().children().text('$'+newst);		
			var id = li.parent().parent().find('.eliminar').attr('id');	
				
			var sum_subtotal = 0;
			t("#tabla_cont > tr > td.td4").each(function(i,e) {
			   sum_subtotal += parseFloat(t(this).children().text().replace('$',''));		 
			});
			t("#total_precio > div > #subT > span").text('$'+sum_subtotal.toFixed(2));
			var options;		
			options = id.split(parseFloat(id));

			var precio_envio = '0';
			
			if( t("#slc_envio_cesta option:selected").attr('title')!= undefined ){
				precio_envio = t("#slc_envio_cesta option:selected").attr('title');
			}
			
			var total = parseFloat(sum_subtotal);		
			var tc = parseFloat(t("#cambio").val());		
			var total_cp = (parseFloat(precio_envio.replace('$','')) + total).toFixed(2);
						
			t("#numdolar").html('$'+(parseFloat(precio_envio.replace('$',''))+total).toFixed(2) );
			t("#numsol").html('S/.'+((parseFloat(precio_envio.replace('$',''))+total)*tc).toFixed(2) );
			
			updateCestaAjax( 'CantidadCesta' , id , cantidad , options[1] );
		}else{
			t(this).val('');
		}
	});
	
	// -- ELIMINAR -- //
	t(".eliminar a").click(function(){
		var id = t(this).parent().attr('id');
		t(this).parent().parent().remove();
		var sum_subtotal = 0;
			
			
		
		if( t("#tabla_cont > tr").length >= 0 ){
			
			t("#tabla_cont > tr > td.td4").each(function(i,e) {
			   sum_subtotal += parseFloat(t(this).children().text().replace('$',''));		 
			});	
				
			t("#total_precio > div > #subT > span").text('$'+sum_subtotal.toFixed(2));
			
			var precio_envio = '0';
			
			if( t("#slc_envio_cesta option:selected").attr('title')!= undefined ){
				precio_envio = t("#slc_envio_cesta option:selected").attr('title');
			}
			
			
			var total = parseFloat(sum_subtotal);		
			var tc = parseFloat(t("#cambio").val());		
			var total_cp = (parseFloat(precio_envio.replace('$','')) + total).toFixed(2);
						
			t("#numdolar").html('$'+(parseFloat(precio_envio.replace('$',''))+total).toFixed(2) );
			t("#numsol").html('S/.'+((parseFloat(precio_envio.replace('$',''))+total)*tc).toFixed(2) );
			
			updateCestaAjax( 'deleteCesta' , id , null , null );
		}
		
		if( t("#tabla_cont > tr").length == 0 ){
			
			t("#tabla_cont > tr > td.td4").each(function(i,e) {
			   sum_subtotal += parseFloat(t(this).children().text().replace('t',''));		 
			});	
			t("#total_precio > div > #subT > span").text('$'+sum_subtotal.toFixed(2));
			t("#total_precio .tpBox:not(:eq(0))").remove();
			t("#total_precio .btn-submit").remove();
			
		}
	});

	function cargardatosEnvio(datos,id) {
	    var listadatos = new Array();
	    listadatos = datos.split('+');
	    //var cadena=listadatos[1];
	    //alert(cadena);
	    t("#nombre").val(listadatos[1]);  
	    t("#apellidos").val(listadatos[2]);   
	    t("#telefono").val(listadatos[3]);  
	    //t("#direccion").val(listadatos[4]);   
	    //t("#referencia").val(listadatos[5]);  
	    //var cadena=listadatos[6]; //latitud_destinatario
	    //var cadena=listadatos[7]; //longitud_destinatario
	    //var cadena=listadatos[8]; //fecha_full_destinatario
	    //alert(cadena);
	}

	function cargardatos(datos,id) {
	    var listadatos = new Array();
	    listadatos = datos.split('+');
	    var cadena=listadatos[0];
	    t("#id_destinatario").val(cadena);
	}
	/*function updateCestaAjax( action , id , k , opciones ){
		t.get('ajax.php',{section:'cesta' , action : action , id:id , cantidad:k , opciones:opciones},function(data){
			t("#carrito .count").html(data);			
		});
	}
	function updateBagShopAjax( action , id , k , opciones ) {
		t.get('ajax.php',{section:'cesta' , action : action , id:id , cantidad:k , opciones:opciones},function(data){
			t("#bag-shop .cuerpo-bag-shop-cal").html(data);			
		});
	}*/
	
	//-- AÑADIR COMPLETENTO -- //
	t(".btn_anadir___").click(function(){
		
		var src = t(this).parent().find('.a_imagen img').attr('src');
		var name_complemento = t(this).parent().find('.nameProd').text();
		var precio = t(this).parent().find('input[name=precio]').val();
		var opcion = t(this).parent().parent().parent().parent().parent().parent().find('input[name=opcion]').val();
		var valor = t(this).parent().find('input[name=id_valor]').val();
		
		complemento = '<li id="'+valor+'"><div class="wrap_agregado">&nbsp;<img src="'+src+'" alt="" /></div>';
		complemento+= '<span>'+name_complemento+' t<b>'+precio+'</b> </span>';
		complemento+= '<a class="eliminar_prod">x Eliminar</a>';		
		complemento+= '</li>';
		
		t("#prod_agregado ul").append(complemento);
		
		var topt = t('form[name=envio_carrito] .opciones_'+valor+'');
		var cantidad_valor = 1;
		
		if( topt.val() != undefined  ){
			cantidad_valor = parseInt(topt.val()) + 1;
			topt.val(cantidad_valor); 
		}else{
			t("form[name=envio_carrito]").append('<input type="hidden" class="opciones_'+valor+'" name="opciones['+valor+']" value="'+cantidad_valor+'">');
		}
		
		
		var precio_temp = 0;
		
		
		t("#prod_agregado ul li").each(function(i, e) {		
			precio_temp += parseFloat(t(this).find('span b').text());	
        });
		
		var precio = t("#detalle_descripcion input[name=precio_producto]").val();
		
		var precio_total = (parseFloat(precio) + parseFloat(precio_temp)) * t("#cant").val();
		
		t("#precio_btn span#precio_temp").text('Precio: t'+precio_total.toFixed(2));
		
		
		if( t("#prod_agregado ul li").length >0){
			t("form[name=envio_carrito] #cant")
		}else{
			
		}
	})
	
	// -- ELIMINAR COMPLEMENTO -- //
	t(".eliminar_prod___").on('click',function(){
		t(this).parent().remove();
		var valor = t(this).parent().attr('id');
		var topt = t('form[name=envio_carrito] .opciones_'+valor+'');		
		var cantidad_valor = 1;
		
		if( topt.val() > 1  ){
			cantidad_valor = parseInt(topt.val()) - 1;
			topt.val(cantidad_valor); 
		}else{
			topt.remove();
		}		
		var precio_temp = 0;
		t("#prod_agregado ul li").each(function(i, e) {	
			precio_temp += parseFloat(t(this).find('span b').text());				
        });		
		var precio = t("#detalle_descripcion input[name=precio_producto]").val();		
		var precio_total = (parseFloat(precio) + parseFloat(precio_temp)) * t("#cant").val();		
		t("#precio_btn span#precio_temp").text('Precio: t'+precio_total.toFixed(2));		
	});
	
	// --- BOX DETALLE Y COSTOS --- //
	t('#cont_costo').hide();
	t("#detalles_costo #tabs h4").click(function(){
		t(this)
			.addClass('active')
			.siblings()
				.removeClass('active');

		var id  = t(this).attr('rel');
		t('#'+id)
			.show()
			.siblings()
				.hide();
	});

	/*TIPO DE COMPROBANTE*/
	t("#comprobante").change(function () {
	  var str = t(this).val();
	  if(str=='Boleta'){
	  	t("#caja1").show();
		t("#caja2").hide();
	  }else{
		 t("#caja2").show();
		 t("#caja1").hide();
	  }
	}).trigger('change');
    
	
	t("#continuarComprando").on('click',function(){
            t.fancybox.close();
	});

	// --- POPUP EN CARRITO --- //
	t(".addCarrito___").on('click',function(){ 
		//alert(t(this).parent().find('input').val());
		var prod = t(this).parent().find('input').val();
		t.fancybox.showLoading();
		tthis = t(this);
		
		t.ajax({
			type:"POST",
			cache:false,
			url:_tpl_+"includes/inc.encarrito.php",
			data: tthis.parents('form.form').serialize(),
			success: function(data) {				
				
				updateCestaAjax( 'listCesta' , null , null , null );
				
				t.fancybox.hideLoading();
				t.fancybox({
					content		: data,
					width		: 580,
					fitToView	: false,
					autoSize	: true,
					closeClick	: false,
					closeBtn 	: true,
					padding 	: 20,		
					'autoDimensions':true,
					'scrolling':'no',
					afterShow	: function(){			
						t('#mas_regalos_popup ul#listado_catalogo li').hover(function(){
							t(this)
								.find('.btn_detalle, .btn_compra')
									.stop()
									.fadeIn();		
						},function(){
							t(this)
								.find('.btn_detalle, .btn_compra')
									.hide();
						});
						var Wbtn = t('.btn_detalle').innerWidth();
						Wli  = t('#listado_catalogo li.limasregalos').innerWidth(); 
						left = (Wli - Wbtn)/2;
					
						t('.limasregalos .btn_detalle, .limasregalos .btn_compra').css({opacity:0.8, left: left});
						t('.btn_detalle, .btn_compra').hover(function(){
							t(this)
								.stop()
								.animate({
									opacity:1
								});
						},function(){
							t(this)
								.stop()
								.animate({
									opacity:0.8
								});
						});
						t('#continuarComprando, #verCarrito').css({opacity:0.8});
						t('#continuarComprando, #verCarrito').hover(function(){
							t(this).stop().animate({opacity:1});
						}, function(){
							t(this).stop().animate({opacity:0.8});
						})
    				}
				});
				
			}
    	});
		return false;
	});

	// --- ACTIVE FORMAS DE PAGO --- //
	t('.formas_pago').click(function(){
		cleanMsgError();
		t(this)
			.addClass('active')
			.siblings()
				.removeClass('active');

		t(this)
			.find('input:radio')
			.attr("checked", "checked");
	});

	// --- BTN VER MAS DETALLE --- //
	if(t('#detalles_costo').length>0){
		var topUbica = t('#detalles_costo').position().top;
		t('.btn_vertodos').click(function(){
			t('html, body')
				.animate({
					scrollTop: topUbica + 120
				}, 'slow');
		});
	}
	
	
	// /* LOGIN POPUP	*/
	// t(".popup").fancybox({
	// 	maxWidth	: 800,
	// 	maxHeight	: 600,
	// 	fitToView	: false,
	// 	width		: '100%',
	// 	height		: '100%',
	// 	autoSize	: true,
	// 	closeClick	: false,
	// 	closeBtn	: false,
	// 	padding		: 0,
	// 	/*
	// 	beforeShow: function() {
	// 		//t.fancybox.close();
	// 		alert('hola');
 //    	},*/
	// 	afterShow	: function(){	
	// 		t("#popup_acceso form input:first").focus();
	// 	}
		
	// });
	
	// /* BTN CLOSE POPUP LOGIN */	
	// t("#btn_close").on("click",function(){
	// 	//no esta funcional
	// 	t.fancybox.close();
	// })

	// /*  LOGIN RAPDIO PEDIDO*/
	// t(".popuprapido").fancybox({
	// 	maxWidth	: 800,
	// 	maxHeight	: 600,
	// 	fitToView	: false,
	// 	width		: '70%',
	// 	height		: '70%',
	// 	autoSize	: true,
	// 	closeClick	: false,
	// 	closeBtn	: false,
	// 	padding		: 0,
	// 	afterShow	: function(){	
	// 		t("#popup_acceso form input:first").focus();
	// 	}
	// });
	
	
	// /* MENSAJES DEDICATORIA POP UP */
	// t(".mensajes").fancybox({
	// 	maxWidth	: 500,
	// 	maxHeight	: 660,
	// 	fitToView	: false,
	// 	width		: '70%',
	// 	height		: '70%',
	// 	autoSize	: true,
	// 	closeBtn	: false,
	// 	padding		: 0
	// });
	
	// /* PREVIEW TARJETA */
	// t(".tarjeta").fancybox({
	// 	maxWidth	: 438,
	// 	maxHeight	: 320,
	// 	fitToView	: false,
	// 	width		: '70%',
	// 	height		: '70%',
	// 	autoSize	: true,
	// 	closeClick	: false,
	// 	closeBtn	: true,
	// 	padding		: 0
	// });
	
	/* VALIDATE COMBO MENSAJES */
	t("#mensajes_plantillas").on("change",function () {
		t("#loading").show();
		t("#mensajes").html('<br/>Cargando...');
		
		if(t(this).val() != ""){
		
		t.get("ajax.php",{id:t(this).val(),action:'listMensajes'},function(data){
			t("#loading").hide();
			
			if(t.isArray(data)){
				
				if( data.length > 0 ){
					var html = '<div class="scrollbar"><div class="track"><div class="thumb"><div class="end"></div></div></div></div><div class="viewport"><div class="overview"><ul id="listmesajes">';
					t.each(data, function(i, item) {
						html+='<li><a title="Click para agregar a tarjeta">'+item.descripcion+'</a></li>';
					})		
					html+='</ul></div></div>';
				}else{
					html = "<br/>No se encontraron mensajes";
				}						
			}
			t("#mensajes").html(html);
			
			/* SCROLL BAR MENSAJES */
			t('#mensajes').tinyscrollbar({ sizethumb: 30 });
			
		},'json');
		
		}else{
			t("#loading").hide();
			t("#mensajes").html('<br/>Eliga una de las opciones');		
		}
		
		
	});
	/* LIsT MENSAJES */
	t("#listmesajes li").on("click",function(){ /*VALIDAR USO*/
		t.fancybox.close();
		var txt = t(this).find("a").text();
		t("#dedicatoria").val(txt);
		t.post("ajax.php",{mensaje:txt},function(data){
			
		})
	})

	t("#realizarcompraquick___").on("click",function(){
                var login = parent.t("#logueadoquick").val();
		if(login==1){
                    
			window.location = _url_web_+'seccion/pedido/envio';
		}else{   
			t.fancybox({
				type : 'ajax',
				href : 'ajax.php?action=loginRapido',
				maxWidth	: 800,
				maxHeight	: 600,
				fitToView	: false,
				autoSize	: true,
				closeClick	: false,
				closeBtn	: false,
				padding		: 0,
				afterShow	: function(){	
					t("#popup_acceso form input:first").focus();
				}
			});
			
		}
	})

	t("#buscarblog").keydown(function(e){
		var q = this.value;
		if( e.keyCode==13 ){
			window.location = 'blog/q='+q;
		}
	})
	
	t("#btnBuscarblog").click(function(){
		var q = t("#buscarblog").val();
		window.location = 'blog/q='+q;
		
	})


	/*DEVELOWEB*/
});




$('.activa-busqueda').click(function () {
	
	if ($('form.site-search').hasClass('search-visible')){
        $('form.site-search').removeClass( "search-visible" );
    }else{
        $('form.site-search').addClass( "search-visible" );
    }
})
/*** INICIO MODAL AGREGAR FECHA ESPECIAL ***/
function validarAgregarFechaEspecial(form) {
	/*
    var email_cliente = form.email_cliente.value;    
    var email_amigo = form.email_amigo.value; 
    var url_enviar_amigo = t(".url_enviar_amigo").html();
    //alert(url_enviar_amigo);

    var emailRegex = /^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/;

    if (email_cliente == "") {
        t(".mensaje-recomendar-amigo").text('Ingresar su correo electrónico');
        t("#email_cliente_recomendado").focus();      
        return false;
    }
    if (!email_cliente.match(emailRegex)) {
        t(".mensaje-recomendar-amigo").text('Ingresar un correo electrónico válido');
        t("#email_cliente_recomendado").focus();      
        return false;
    }
    if (email_amigo == "") {
        t(".mensaje-recomendar-amigo").text('Ingresar el correo electrónico de su amigo');
        t("#email_amigo_recomendado").focus();      
        return false;
    }
    if (!email_amigo.match(emailRegex)) {
        t(".mensaje-recomendar-amigo").text('Ingresar el correo electrónico de su amigo válido');
        t("#email_amigo_recomendado").focus();         
        return false;
    }
    if(document.getElementById('privacidad_recomendado').checked == false){
        t(".mensaje-recomendar-amigo").text('Debe aceptar los Términos y Condiciones.');
        return false;
    }
    */
    //var ruta=t("#ruta_web").val();
    t.ajax({     
              type  : "GET", 
              url   : "ajax.php?action=addClienteDestinatario",
              data  : t("#form-add-fecha-especial").serialize(),
              success: function(data) {
              		/*
                    t("#fecha_especial").val(date('d/m/Y')); 
                    t("#id_tipo_destinatario").val('');  
                    t("#id_ocasion").val('');
                    */
                    t('.modal-agregar-fecha-especial').modal('hide');
              		t(".container-body-fechas-especiales").text('');
                    t(".container-body-fechas-especiales").html(data);
                    //var URLactual = window.location;
                    //window.location.replace(URLactual);
                    /*
                    setTimeout(function(){
                        //t('.modal-agregar-fecha-especial').modal('hide');
                        var URLactual = window.location;
                      	window.location.replace(URLactual);
                    },5000)
                    */
              },
              beforeSend: function(objeto){
                                 
              },
              complete: function(){                
              }
    });
    
    return false;
}
/*** FIN MODAL AGREGAR FECHA ESPECIAL ***/

/*** INICIO MODAL NUEVA FECHA ESPECIAL ***/
function validarNuevaFechaEspecial(form) {

    //var ruta=t("#ruta_web").val();
    t.ajax({     
              type  : "GET", 
              url   : "ajax.php?action=nuevoClienteDestinatario",
              data  : t("#form-nueva-fecha-especial").serialize(),
              success: function(data) {
              		t('.modal-nueva-fecha-especial').modal('hide');
              		t(".container-body-fechas-especiales").text('');
                    //t("#fecha_especial").val(date('d/m/Y')); 
                    //t("#id_tipo_destinatario").val('');  
                    //t("#id_ocasion").val('');
                    //var URLactual = window.location;
                    //window.location.replace(URLactual);

                    t(".container-body-fechas-especiales").html(data);
                 
              },
              beforeSend: function(objeto){
                                 
              },
              complete: function(){                
              }
    });
    
    return false;
}
/*** FIN MODAL NUEVA FECHA ESPECIAL ***/

function iniciarChat() {
	setTimeout(function () {
		t('.purechat-message-note').text('Hola en que podemos ayudarte');
	}, 100);
}



function show_menor_edad(){
	
	if( t("input[name='menor_edad']:checked").val()==1 ){
		t('#nombres_tutor').focus();				
		t('#nombres_tutor').attr("readonly",false);		
		t('#documento_tutor').attr("readonly",false);						
	}else{
		t('#nombres_tutor').attr("readonly",true);		
		t('#documento_tutor').attr("readonly",true);						
		
	}
}

function show_empresa(){
	if( t("input[name='persona_natural']:checked").val()==2 ){ // Persona Natural
		t('#razon_social').attr("readonly",false);						
	}else{ // Persona Juridica
		t('#razon_social').attr("readonly",true);						
	}
}

// Listado de COMBOS 1
function show_provincia(data){
			
}

function show_distrito(data){
		
}



function validate_form_reclamo( form ){
	var nombres = form.nombres.value;
	var domicilio = form.direccion2.value;
	var numero_documento = form.numero_documento.value;
	var razon_social = form.razon_social.value;
	var telefono = form.telefonos2.value;
	var distrito = form.distrito.value;
	var email = form.email.value;
	var nombres_tutor = form.nombres_tutor.value;
	var documento_tutor = form.documento_tutor.value;
	var documento_numero_pago = form.documento_numero_pago.value;
	var sedes = form.sedes.value;
	var descripcion_servicio = form.descripcion_servicio.value; 
	var descripcion_reclamacion = form.descripcion_reclamacion.value; 
	
	var emailRegex = /^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/;
		
	if( t("input[name='persona_natural']:checked").val()==1 ){}else{ 
	// Persona Juridica
		if( razon_social == "" ){
			alert('Ingrese su razón social');
			form.razon_social.focus();
			return false;
		}					
	}
	
	if( nombres == "" ){
		alert('Ingrese su nombre y apellido');
		form.nombres.focus();
		return false;
	}if( numero_documento == "" ){
		alert('Ingrese su numero de documento');
		form.numero_documento.focus();
		return false;
	}if( domicilio == "" ){
		alert('Ingrese su domicilio');
		form.domicilio.focus();
		return false;
	}if( telefono == "" ){
		alert('Ingrese su telefono');
		form.telefono.focus();
		return false;
	}if( distrito == "--" ){
		alert('Seleccione su distrito');
		form.distrito.focus();
		return false;
	}if( email == " " ){
		alert('Ingrese su email');
		form.email.focus();
		return false;
	}if(!email.match(emailRegex)) {
		alert('Ha ingresado un email inválido');
		form.email.focus();
		return false;
	}
	
	if( t("input[name='menor_edad']:checked").val()==1 ){
		if( nombres_tutor == " " ){
			alert('Ingrese el nombre del tutor');
			form.nombres_tutor.focus();
			return false;
		}if( documento_tutor == " " ){
			alert('Ingrese el documento del tutor');
			form.documento_tutor.focus();
			return false;
		}
	}
	

	
	if( documento_numero_pago == " " ){
		alert('Ingrese el numero del comprobante de pago');
		form.documento_numero_pago.focus();
		return false;
	}if( descripcion_servicio == " " ){
		alert('Ingrese la descripcion del servicio');
		form.descripcion_servicio.focus();
		return false;
	}if( descripcion_reclamacion == " " ){
		alert('Ingrese la descripcion del reclamo');
		form.descripcion_reclamacion.focus();
		return false;
	}
		
	if(!t("input[name='condicion']").is(":checked")){
		alert('Debe seleccionar el check final del confirmación');
		t("input[name='condicion']").focus();
		return false;
	}
	
	
	t.fancybox.showLoading();
	
	t.ajax({
			type:"GET",
			cache:false,
			url:"ajax.php",
			data: t("#form_reclamacion").serialize(),
			success: function(data) {
				if(data=='1'){
					t.fancybox.hideLoading();
					t("#form_reclamacion input,#form_reclamacion textarea").val('');
					
					t.fancybox({
						content	: '<div id="franja-top"></div><div id="popup_acceso" class="olvidaste"><a id="btn_close"></a><h2>Envío de Reclamación</h2><br/><br/>Se envió email correctamente<br/><br/></div>',
						padding		: 0,
						closeBtn	: false						
					});
					setTimeout(function(){
						t.fancybox.close();
					},3000)
				}
			}
	});
	
	return false;
	
}

function validate_login_rapido( form , action ){
	
	var nombres = form.nombres.value;
	var apellidos = form.apellidos.value;
	var email = form.email.value;
	var telefono = form.telefono.value; 
	var ciudad = form.ciudad.value; 
	var pais = form.pais.value; 
	var emailRegex = /^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/;
		
	t(".img_error").html('');
	
	if(nombres == "") {
		t(".img_error").remove();
		t("#popup_acceso form input").removeClass("error");
		t("#nombres").addClass('error').before('<div class="img_error"></div>');
		t("#nombres").focus();
		return false;
	}
	if(apellidos == "") {
		t(".img_error").remove();
		t("#popup_acceso form input").removeClass("error");
		t("#apellidos").addClass('error').before('<div class="img_error"></div>');
		t("#apellidos").focus();
		return false;
	}
	if(email == "") {
		t(".img_error").remove();
		t("#popup_acceso form input").removeClass("error");
		t("#email").addClass('error').before('<div class="img_error"></div>');
		t("#email").focus();
		return false;
	}
	if(!email.match(emailRegex)) {
		t(".img_error").remove();
		t("#popup_acceso form input").removeClass("error");
		t("#email").addClass('error').before('<div class="img_error"></div>');
		t("#email").focus();
		return false;
	}
	if( telefono == "" ){
		t(".img_error").remove();
		t("#popup_acceso form input").removeClass("error");
		t("#telefono").addClass('error').before('<div class="img_error"></div>');
		t("#telefono").focus();
		return false;
	}
	if( pais == "" ){
		t(".img_error").remove();
		t("#popup_acceso form input").removeClass("error");
		t("#pais").addClass('error').before('<div class="img_error"></div>');
		t("#pais").focus();
		return false;
	}
	if( ciudad == "" ){
		t(".img_error").remove();
		t("#popup_acceso form input").removeClass("error");
		t("#ciudad").addClass('error').before('<div class="img_error"></div>');
		t("#ciudad").focus();
		return false;
	}
	
	
	t(".img_error").remove();
	t("#registro-form input").removeClass("error");
		
	eval('action()');
	
	return false;
	
}

function validate_busqueda(form){
	var q = form.q.value;
	if(q==""){
		return false;
	}else{
		return true;
	}
}

jQuery.preloadImages = function()
{
  for(var i = 0; i<arguments.length; i++)
  {
    jQuery("<img>").attr("src", arguments[i]);
  }
}
/*enviar cesta*/
$('#cesta').submit(function(e){	
    var logeado = $('#cesta #logeado').val();
    if(logeado){
		/*se envia el formulario*/
	}else{
		alert('mostrar modal login rapido');
		return false;
	}
});
/*enviar cesta*/
function validate_pedido(form){
	var logeado = form.logeado.value;
	if(logeado){
		form.submit();
	}else{
		alert('mostrar modal login rapido');
	}
	return false;
}

function addCuenta(){
	var data = ($('.modal-registrarse:visible').length > 0)?$("form.registro-form").serialize():$("form.registro-rapido-form").serialize();
	$.ajax({
			type:"GET",
			cache:false,
			url:"ajax.php",
			//data: t("#registro-form").serialize()+'&action=addCuenta',
			data: data+'&action=addCuenta',
			success: function(data) {
				if(data=='1'){
					// cliente registrado sin productos en la cesta
					$("#popup_acceso form input").val('');
					$('.modal-registrarse').modal('hide');
					$('.modal-redireccionar').modal('show');
	                $('.modal-redireccionar .modal-container').html('');
	                $('.modal-redireccionar .titulo-header').html('Soy nuevo cliente, regístrate aquí:');
	                var contenido = '<br><p>Redirigiendo a su cuenta ...</p><br>';
	                $('.modal-redireccionar .modal-container').append(contenido);
					setTimeout(function(){
						$("body").animate({opacity:0},500,function(){
							window.location=_url_web_+'seccion/cuenta/edit';
						})	
						$('.modal-redireccionar').modal('hide');					
					},3000)
				}else if(data=='2'){
					// cliente registrado pero con productos en la cesta
					$("#popup_acceso form input").val('');
					$('.modal-login-rapido').modal('hide');
					$('.modal-registrarse').modal('hide');
					$('.modal-redireccionar').modal('show');
	                $('.modal-redireccionar .modal-container').html('');
	                var contenido = '<div id="franja-top"></div><div id="popup_acceso" class="login"><h2>Entrar aquí:</h2><br/><br/>Redirigiendo a pedido ...<br/><br/></div>';
	                $('.modal-redireccionar .modal-container').append(contenido);
					setTimeout(function(){
						$("body").animate({opacity:0},500,function(){
							window.location=_url_web_+'seccion/pedido/envio';
						})	
						$('.modal-redireccionar .modal-container').modal('hide');
					},3000)
				}else{
					$("#email").addClass('error').before('<div class="img_error"></div>');					
					$("#email").focus();
				}
			}
	});
}
function updateCuenta(){
	$("#loading_cuenta").show();	
	$.ajax({
			type:"GET",
			cache:false,
			url:"ajax.php",
			data: $("#registro-form").serialize()+'&action=updateCuenta',
			success: function(data) {
				if(data=='1'){
					$("#loading_cuenta").hide();
					$("#txtrptacuenta").show();
					setTimeout(function(){
						$("#txtrptacuenta").fadeOut('fast');
					},2000);
				}else{
					
				}
			}
	});
}

function validate_descarga ( form ){
	var name_catalogo = form.name_catalogo.value;
	var mail_catalogo = form.mail_catalogo.value;
	
	var emailRegex = /^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/;
	t(".img_error").html('');
	if(name_catalogo == "") {
		t(".img_error").remove();
		t("#dCatalogo form li").removeClass("error");
		t("#name_catalogo").parent().addClass('error').children().before('<div class="img_error"></div>');
		t("#name_catalogo").focus();
		return false;
	}if(mail_catalogo == "") {
		t(".img_error").remove();
		t("#dCatalogo form li").removeClass("error");
		t("#mail_catalogo").parent().addClass('error').children().before('<div class="img_error"></div>');
		t("#mail_catalogo").focus();
		return false;
	}if(!mail_catalogo.match(emailRegex)) {
		t(".img_error").remove();
		t("#dCatalogo form li").removeClass("error");
		t("#mail_catalogo").parent().addClass('error').children().before('<div class="img_error"></div>');
		t("#mail_catalogo").focus();
		return false;
	}
	
	t(".img_error").remove();
	t("#dCatalogo form li").removeClass("error");
	
	t.fancybox.showLoading();
	
	t.ajax({
			type:"GET",
			cache:false,
			url:"ajax.php",
			data: t("#form-download-catalogo").serialize()+'&action=addCliente',
			success: function(data) {
				if(data=='1'){
					t.fancybox.hideLoading();
					t.fancybox({
						content	: '<div id="franja-top"></div><div id="popup_acceso" class="olvidaste"><a id="btn_close"></a><h2>Descarga tu catalogo</h2><br/><br/>Hola '+t("#name_catalogo").val()+', se ha enviado al email '+t("#mail_catalogo").val()+' un enlace para que puede descargar el catalogo de Don Regalo, <br/><br/>Gracias.<br/><br/></div>',
						padding		: 0,
						closeBtn	: false						
					});
					t("#form-download-catalogo input").val('');
					setTimeout(function(){
						t.fancybox.close();
					},10000)
				}
			}
	});
	
	return false;
}

function validate_registro( form , action ){
	var nombres = form.nombres.value;
	var apellidos = form.apellidos.value;
	var email = form.email.value;
		
	var password = (form.password != undefined)?form.password.value:''; 
	var repeat_password = (form.password != undefined)?form.repeat_password.value:''; 
	
	var telefono = form.telefono.value; 
	var direccion = form.direccion.value; 
	var ciudad = form.ciudad.value; 
	var pais = form.pais.value; 
	var emailRegex = /^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/;

	$(".img_error").html('');
	
	if(nombres == "") {
		$(".img_error").remove();
		$("#popup_acceso form input").removeClass("error");
		$("#nombres").addClass('error').before('<div class="img_error"></div>');
		$("#nombres").focus();
		return false;
	}
	if(apellidos == "") {
		$(".img_error").remove();
		$("#popup_acceso form input").removeClass("error");
		$("#apellidos").addClass('error').before('<div class="img_error"></div>');
		$("#apellidos").focus();
		return false;
	}
	if(email == "") {
	
		$(".img_error").remove();
		$("#popup_acceso form input").removeClass("error");
		$("#email").addClass('error').before('<div class="img_error"></div>');
		$("#email").focus();
		return false;
	}
	if(!email.match(emailRegex)) {
		
		$(".img_error").remove();
		$("#popup_acceso form input").removeClass("error");
		$("#email").addClass('error').before('<div class="img_error"></div>');
		$("#email").focus();
		return false;
	}	 
	if(form.password != undefined && password == "") {

		$(".img_error").remove();
		$("#popup_acceso form input").removeClass("error");
		$("#password").addClass('error').before('<div class="img_error"></div>');
		$("#password").focus();
		return false;
	}
	if(form.password != undefined && repeat_password == "") {
		
		$(".img_error").remove();
		$("#popup_acceso form input").removeClass("error");
		$("#repeat_password").addClass('error').before('<div class="img_error"></div>');
		$("#repeat_password").focus();
		return false;
	}
	if( password != repeat_password ){
		
		$(".img_error").remove();
		$("#popup_acceso form input").removeClass("error");
		$("#password").addClass('error').before('<div class="img_error"></div>');
		$("#repeat_password").addClass('error').before('<div class="img_error"></div>');
		$("#password").focus();		
		return false;
	}
	if( telefono == "" ){
		
		$(".img_error").remove();
		$("#popup_acceso form input").removeClass("error");
		$("#telefono").addClass('error').before('<div class="img_error"></div>');
		$("#telefono").focus();
		return false;
	}
	if( direccion == "" ){
	
		$(".img_error").remove();
		$("#popup_acceso form input").removeClass("error");
		$("#direccion").addClass('error').before('<div class="img_error"></div>');
		$("#direccion").focus();
		return false;
	}
	if( ciudad == "" ){
		
		$(".img_error").remove();
		$("#popup_acceso form input").removeClass("error");
		$("#ciudad").addClass('error').before('<div class="img_error"></div>');
		$("#ciudad").focus();
		return false;
	}
	if( pais == "" ){
		
		$(".img_error").remove();
		$("#popup_acceso form input").removeClass("error");
		$("#pais").addClass('error').before('<div class="img_error"></div>');
		$("#pais").focus();
		return false;
	}
	
	$(".img_error").remove();
	$("#registro-form input").removeClass("error");

	eval('action()');
	
	return false;
}

function updatePasswordCuenta( form ){
	var password_actual = (form.password_actual != undefined)?form.password_actual.value:''; 
	var password_nuevo = (form.password_nuevo != undefined)?form.password_nuevo.value:''; 
	var password_repeat_nuevo = (form.password_repeat_nuevo != undefined)?form.password_repeat_nuevo.value:''; 
	
	if(form.password_actual!= undefined && password_actual == "") {
		t(".img_error").remove();
		t("form input").removeClass("error");
		t("#password_actual").addClass('error').before('<div class="img_error"></div>');
		t("#password_actual").focus();
		return false;
	}
	
	if(form.password_nuevo != undefined && password_nuevo == "") {
		t(".img_error").remove();
		t("form input").removeClass("error");
		t("#password_nuevo").addClass('error').before('<div class="img_error"></div>');
		t("#password_nuevo").focus();
		return false;
	}
	if(form.password_repeat_nuevo != undefined && password_repeat_nuevo == "") {
		t(".img_error").remove();
		t("form input").removeClass("error");
		t("#password_repeat_nuevo").addClass('error').before('<div class="img_error"></div>');
		t("#password_repeat_nuevo").focus();
		return false;
	}
	if( password_nuevo != password_repeat_nuevo ){
		t(".img_error").remove();
		t("form input").removeClass("error");
		t("#password_nuevo").addClass('error').before('<div class="img_error"></div>');
		t("#password_repeat_nuevo").addClass('error').before('<div class="img_error"></div>');
		t("#password_nuevo").focus();		
		return false;
	}
	
	t(".img_error").remove();
	t("form input").removeClass("error");
	
	t("#loading_cuenta").show();
	t.ajax({
                type:"GET",
                cache:false,
                url:"ajax.php",
                data: t("#registro-form").serialize()+'&action=updatePasswordCuenta',
                success: function(data) {
                        if(data=='1'){
                                t("#loading_cuenta").hide();
                                t("#txtrptacuenta").show();
                                setTimeout(function(){
                                        t("#txtrptacuenta").fadeOut('fast');
                                },2000);
                        }else{
                                t("#password_actual").addClass('error').before('<div class="img_error"></div>');
                                t("#password_actual").focus();
                        }
                }
	});
	
	return false;
	
}

function validate_olvidastePassword(form){
	var email_olvidaste_password = form.email_olvidaste_password.value;
	var emailRegex = /^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/;
	t(".img_error").html('');
	
	if(email_olvidaste_password == "") {
		t(".img_error").remove();
		t("#popup_acceso form input").removeClass("error");
		t("#email_olvidaste_password").addClass('error').before('<div class="img_error"></div>');
		t("#email_olvidaste_password").focus();
		return false;
	}
	if(!email_olvidaste_password.match(emailRegex)) {
		t(".img_error").remove();
		t("#popup_acceso form input").removeClass("error");
		t("#email_olvidaste_password").addClass('error').before('<div class="img_error"></div>');
		t("#email_olvidaste_password").focus();
		return false;
	}
		
	t(".img_error").remove();
	t("#popup_acceso form input").removeClass("error");
	
	t.ajax({
			type:"GET",
			cache:false,
			url:"ajax.php",
			data: t("#olvidaste-password-form").serialize(),
			success: function(data) {
				if(data=='1'){
					t("#popup_acceso form input").val('');
					t('.modal-olvidaste-password').modal('hide');
					t('.modal-redireccionar').modal('show');
					t('.modal-redireccionar .modal-container').html('');
					var contenido = '<div id="franja-top"></div><div id="popup_acceso" class="olvidaste"><h2>¿Olvidaste tu Password?</h2><br/><br/>Se envió email correctamente<br/><br/></div>';
					t('.modal-redireccionar .modal-container').append(contenido);
					setTimeout(function(){
						//var URLactual = window.location;
                      	//window.location.replace(URLactual);
                      	t('.modal-redireccionar').modal('hide');
					},3000)
				}else{
					t("#email_olvidaste_password").addClass('error').before('<div class="img_error"></div>');					
					t("#email_login").focus();
				}
			}
	});
	return false;
}


/* VALIDATE LOGIN POPUP */
$('#login-form').submit(function(e){
    e.preventDefault();
    var email_login = $('#login-form #email_login').val();
	var password_login = $('#login-form #password_login').val();
	var emailRegex = /^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/;

	if(email_login == "") {
		$(".img_error").remove();
		$("#popup_acceso form input").removeClass("error");
		$("#email_login").addClass('error').before('<div class="img_error"></div>');
		$("#email_login").focus();
	
		
		return false;
	}
	if(!email_login.match(emailRegex)) {
		$(".img_error").remove();
		$("#popup_acceso form input").removeClass("error");
		$("#email_login").addClass('error').before('<div class="img_error"></div>');
		$("#email_login").focus();
		
		
		
		return false;
	}	 
	if(password_login == "") {
		$(".img_error").remove();
		$("#popup_acceso form input").removeClass("error");
		$("#password_login").addClass('error').before('<div class="img_error"></div>');
		$("#password_login").focus();
		
		
		return false;
	}
	
	$(".img_error").remove();
	$("#popup_acceso form input").removeClass("error");
	
	$.ajax({
			type:"GET",
			cache:false,
			url:"ajax.php?action=acceso",
			data: $('#login-form').serialize(),
			success: function(data) {
				if(data=='1'){
					// cliente registrado pero sin productos en la cesta
					$('.modal-login').modal('hide');
					$('.modal-redireccionar').modal('show');
					$('.modal-redireccionar .titulo-header').html('');
					$('.modal-redireccionar .modal-container').html('<br><p>Redirigiendo a su cuenta ...</p><br>');
					var contenido = 'Ingresar aquí: ';
					$('.modal-redireccionar .titulo-header').append(contenido);
					setTimeout(function(){
						location.reload(true);
					},3000)
				}else if (data=='2'){
					// cliente registrado pero con productos en la cesta
					$("#popup_acceso form input").val('');
					var url = document.URL;	
					$('.modal-login').modal('hide');
					$('.modal-redireccionar').modal('show');
					$('.modal-redireccionar .titulo-header').html('');
					$('.modal-redireccionar .modal-container').html('<br><p>Redirigiendo a pedido ...</p><br>');
					var contenido = 'Ingresar aquí: ';
					$('.modal-redireccionar .titulo-header').append(contenido);
					setTimeout(function(){
						if(url.match(/pedido/))	{	
							document.forms["cesta"].submit();
						}else{
							window.location = _url_web_+'seccion/pedido';
						}
					},3000)			
				}else{
					$("#email_login").addClass('error').before('<div class="img_error"></div>');
					$("#password_login").addClass('error').before('<div class="img_error"></div>');
					$("#email_login").focus();
				}
			}
	});
	return false;
  });


function validate_entrega( form ){
	
	var nombre = form.nombre.value;
	var apellidos = form.apellidos.value;	
	var telefono = form.telefono.value;  
	var fecha_hora = form.fecha_hora.value;
	var distrito = form.distrito.value;
	var direccion = form.direccion.value;
	var referencia = form.referencia.value;
	var dedicatoria = form.dedicatoria.value;		
	
	cleanMsgError();
	
	if( nombre == "" ){
		msgError(form.nombre);
		return false;
	}if( apellidos == "" ){
		msgError(form.apellidos);
		return false;
	}if( telefono == "" ){
		msgError(form.telefono);
		return false;
	}if( fecha_hora == "" ){
		msgError(form.fecha_hora);
		return false;
	}if( distrito == "" ){
		msgError(form.distrito);
		return false;
	}if( direccion == "" ){
		msgError(form.direccion);
		return false;
	}if( referencia == "" ){
		msgError(form.referencia);
		return false;
	}if( dedicatoria == "" ){
		msgError(form.dedicatoria);
		return false;
	}
}

function validate_pago( form ){
	
	var comprobante = form.comprobante.value;
	var pago = form.pago;
	
	cleanMsgError();
	
	if ( comprobante == 'Boleta'){
		var nombre = form.nombre.value;
		var direccionb = form.direccionb.value;
		
		 if( nombre == "" ){
			msgError(form.nombre);
			return false;
		}if( direccionb == "" ){
			msgError(form.direccionb);
			return false;
		}		
	}
	if( comprobante == 'Factura' ){
		var razonsocial = form.razonsocial.value;
		var ruc = form.ruc.value;
		var direccionf = form.direccionf.value;
		
		if( razonsocial == "" ){
			msgError(form.razonsocial);
			return false;
		}if( ruc == "" ){
			msgError(form.ruc);
			return false;
		}if( direccionf == "" ){
			msgError(form.direccionf);
			return false;
		}	
	}
	
	var check = false;
	
	for( i = 0 ; i < pago.length ; i++ ){
		if(pago[i].checked == true ){
			check = true;
			break;
		}
	}
	
	if( check ){
		return true;
	}else{
		for( i = 0 ; i < pago.length ; i++ ){
			msgError(pago[i]);
		}
	}
	
	return false;
	
}


function cleanMsgError(){
	$('.img_error').remove();
	$('input , select , textarea').removeClass('error');
}

function msgError(id){	
	$(id).before('<div class="img_error"></div>').addClass('error');
	$(id).focus();
}


function deleteRow(id, num){
	$(".body-cesta").css("opacity","0.3");
	$(".loading").show();
	$.get('operations.php',{param:'delete-row', id:id}, function(data){
		var resumen = data.split("|");
		$(".articles").text((resumen[1] == 1) ? "1 item" : resumen[1]+" items");
		var total = (parseFloat(resumen[2])).toFixed(2)
		$("#cesta_total h3").html("TOTAL: S/. "+total);
		if(resumen[1] == 0){
			$(".bottom-cesta").remove();
			$("#cesta_compras_content").append('<div class="cesta-nothing"><div class="mensaje_vacio">Su cesta se encuentra vacia</div></div><div align="right" class="btncontinuarcesta"></div>');	
			$(".hide_bottom").hide();
			
		}
		if(resumen[0] == 0){
			$(".info").hide();
		}
		$(".loading").hide();	
		$("#"+num).remove();
		$(".body-cesta").css("opacity","10");						   
	});
}

function openPopup(url, w, h, modo, param){
    t("#TB_window").remove();
    t("body").append("<div id='TB_window'></div>");
    tb_show("", url+"?width="+w+"&height="+h+"&modal="+modo+param, "");
}

function checkTheKey(keyCode){
	if(event.keyCode==13){	
		valida();
		return true ;
	}
	return false ;
}

var testresults
function checkemail(value){
	var str = value
	var filter=/^.+@.+\..{2,3}t/
		if (filter.test(str))
		testresults=true
	else{
		testresults=false
	}
	return (testresults)
}




var scrolling = null;
function scroll_up() {
	var d = document.getElementById('scroller');
	d.scrollTop = d.scrollTop - 5;
	scrolling = window.setTimeout(function() {
		scroll_up();
	}, 50);
}
function scroll_down() {
	var d = document.getElementById('scroller');
	d.scrollTop = d.scrollTop + 5;
	scrolling = window.setTimeout(function() {
		scroll_down();
	}, 50);
}
function stop_scroll() {
	window.clearTimeout(scrolling);
}


function next_productos(v){
	var page = parseInt(t(".page_prod").text()) + 1;
	
	if(page <= v){
		t("#load_productos").addClass("loading");
		t(".page_prod").text(page);
		t.get("ajax.php",{pag:page, param:'page_prods'},function(data){
			t("#load_productos").html(data).removeClass("loading");
		});
	}
}

function prev_productos(v){
	var page = parseInt(t(".page_prod").text()) - 1;
	if(page > 0){
		t("#load_productos").addClass("loading");
		t(".page_prod").text(page); 
		t.get("ajax.php",{pag:page, param:'page_prods'},function(data){
			t("#load_productos").html(data).removeClass("loading");
		});
	}
}


function next_productos_rel(v,idp){

	var page = parseInt(t(".page_prod").text()) + 1;
	
	if(page <= v){
		t("#load_productos_relacionados").addClass("loading");
		t(".page_prod").text(page);
		t.get("ajax.php",{pag:page, param:'page_prods_rel', id:idp},function(data){
			t("#load_productos_relacionados").html(data).removeClass("loading");
		});
	}
	
}

function prev_productos_rel(v,idp){
	
	var page = parseInt(t(".page_prod").text()) - 1;
	
	if(page > 0){
		t("#load_productos_relacionados").addClass("loading");
		
		t(".page_prod").text(page); 
		t.get("ajax.php",{pag:page, param:'page_prods_rel', id:idp},function(data){
			t("#load_productos_relacionados").html(data).removeClass("loading");
		});
	}

}




















//var _url_ = "http://localhost/nuevode/"
var _url_ = "http://www.deaventura.pe/"
var desde_comentario = false;

function validarLogeoInformacion(form){    

    //var logeo_informacion_personal = form.logeo_informacion_personal.value;
    var email = form.email.value;    
    var password = form.password.value;
    var ruta_actividades_venta = form.ruta_actividades_venta.value; 
    var ruta=form.url.value;      
    
    var emailRegex = /^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/;    
    
    if (email == "") {
        inlineMsg('email', '<strong>Error</strong><br />Usted debe ingresar su correo electr&oacute;nico.', 2);
        return false;
    }
    if (!email.match(emailRegex)) {
        inlineMsg('email', '<strong>Error</strong><br />Ha introducido una direcci&oacute;n de correo electr&oacute;nico no v&aacute;lida.', 2);
        return false;
    }

    if (password == "") {
        inlineMsg('password', 'Usted debe ingresar un password.', 2);
        return false;
    }  
   
    t.ajax({     
              type  : "POST", 
              //url: 'validateUser.php?logeo_sistema=1&email=email&password=password',
              url: ruta+'validateUser.php?logeo_sistema=1&email=email&password=password',
              data  : t("#form_logeo_informacion").serialize(),
              success: function(data) {  
                    
                    if(data==1){
                        //alert(ruta_actividades_venta);
                        if(ruta_actividades_venta!=''){                        
                            window.location.replace(ruta_actividades_venta);  
                        }else{                             
                            window.location.replace(ruta+"/cuenta.php?cuenta=bienvenido");                       
                        }   
                        //window.location.replace(ruta_actividades_venta);  
                    }else{                        
                        
                        t("#email_informacion").val('');
                        t("#password_informacion").val('');                                              
                        t("#mensaje_logeo_informacion").show();  
                        t("#email_informacion").focus();  
                        return false;
                    }   
              },
              beforeSend: function(objeto){
                                       
              },
              complete: function(){                
              }
    });
    return false;
}

function validarLogeo(form){ // valida logueo desde un formulario
    //alert("hola");
    var email = form.email.value;    
    var password = form.password.value;   
    var base_url= _url_;
    var emailRegex = /^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/;
    
    if (email == "") {
        inlineMsg('email', '<strong>Error</strong><br />Usted debe ingresar su correo electr&oacute;nico.', 2);
        return false;
    }
    if (!email.match(emailRegex)) {
        inlineMsg('email', '<strong>Error</strong><br />Ha introducido una direcci&oacute;n de correo electr&oacute;nico no v&aacute;lida.', 2);
        return false;
    }

    if (password == "") {
        inlineMsg('password', 'Usted debe ingresar un password.', 2);
        return false;
    }  
   
    t.ajax({     
              type  : "POST", 
              url: base_url+'validateUser.php?logeo_sistema=1&email=email&password=password',
              data  : t("#form_datos").serialize(),
              success: function(data) {  
                    //alert(data);
                    if(data==1){ 
                        window.location.replace(base_url+"cuenta.php?cuenta=bienvenido"); 
                    }else{                        
                        
                        t("#email").val('');
                        t("#password").val('');                                              
                        t("#mensaje_logeo").show();  
                        t("#email").focus();  
                        return false;
                    }   
              },
              beforeSend: function(objeto){
                                 
              },
              complete: function(){                
              }
    });
    return false;
}

function validarLogeoComentario(form){ // valida logueo desde un formulario
    //alert("hola");
    var email = form.email.value;    
    var password = form.password.value;   
    var base_url= _url_;
    var emailRegex = /^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/;
    var url_actual = _url_+t("#url_page").val() + '#comment';
    var mensaje = t("#opinion").val();
    var url_page = t("#url_page").val()
    
    if (email == "") {
        inlineMsg('email', '<strong>Error</strong><br />Usted debe ingresar su correo electr&oacute;nico.', 2);
        return false;
    }
    if (!email.match(emailRegex)) {
        inlineMsg('email', '<strong>Error</strong><br />Ha introducido una direcci&oacute;n de correo electr&oacute;nico no v&aacute;lida.', 2);
        return false;
    }

    if (password == "") {
        inlineMsg('password', 'Usted debe ingresar un password.', 2);
        return false;
    }  
     
    t.ajax({     
              type  : "POST", 
              url   : base_url+'validateUser.php',
              data  : t("#loginForm").serialize(),
              success: function(data) {  
                    if(data != 0){  
                        usuario = data.split("-"); 
                        comentar(url_page, usuario[1],usuario[2],mensaje);
                        //window.location.reload(url_actual);
                        window.location.replace(url_actual); 
                    }else{                        
                        
                        t("#email").val('');
                        t("#password").val('');                                              
                        t("#mensaje_logeo").show();  
                        t("#email").focus();  
                        return false;
                    }   
              },
              beforeSend: function(objeto){
                                 
              },
              complete: function(){                
              }
    });
    return false;
}

function validarMailAmigos(form) {
  
    var email_cliente = form.email_cliente.value;    
    var email_amigo = form.email_amigo.value;   
    var url_actividad = form.url_actividad.value;
    var titulo_actividad = form.titulo_actividad.value; 

    var emailRegex = /^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/;
    
    if (email_cliente == "") {
        t("#email_cliente").val('');
        t("#email_cliente_validacion").show();  
        t("#email_amigo_validacion").hide();       
        t("#email_cliente").focus();      
        return false;
    }
    if (!email_cliente.match(emailRegex)) {
        t("#email_cliente").val('');
        t("#email_cliente_validacion").show();  
        t("#email_amigo_validacion").hide();       
        t("#email_cliente").focus();      
        return false;
    }
    if (email_amigo == "") {
        t("#email_amigo").val('');
        t("#email_cliente_validacion").hide();  
        t("#email_amigo_validacion").show();       
        t("#email_amigo").focus();      
        return false;
    }
    if (!email_amigo.match(emailRegex)) {
        t("#email_amigo").val('');
        t("#email_cliente_validacion").hide();  
        t("#email_amigo_validacion").show();       
        t("#email_amigo").focus();         
        return false;
    }

    t.ajax({     
              type  : "POST", 
              url: _url_+'/validateUser.php?mail_amigo=1&email_cliente='+email_cliente+'&email_amigo='+email_amigo+'&url_actividad='+url_actividad+'&titulo_actividad='+titulo_actividad,
              data  : t("#form_datos_mail").serialize(),
              success: function(data) {  
                    //alert(data);
                    t("#email_cliente").val(''); 
                    t("#email_amigo").val('');  
                    t("#email_cliente_validacion").hide();  
                    t("#email_amigo_validacion").hide();                         
                    if(data==1){                        
                        //window.location.replace("/cuenta.php?cuenta=bienvenido"); 
                        t("#email_amigo_mensaje").show();
                    }else{                        
                    
                    }                       
              },
              beforeSend: function(objeto){
                                 
              },
              complete: function(){                
              }
    });
    return false;
    
}

function enviarContrasena(form) {
    var email = form.email.value; 
    var ruta=form.ruta.value;         
     
    var emailRegex = /^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/;
    
    if (email == "") {
        t("#email").val('');
        t("#mensaje_validacion_mail").hide();  
        t("#mensaje_validacion_vacio").show();      
        return false;
    }
    if (!email.match(emailRegex)) {
        t("#email").val('');
        t("#mensaje_validacion_vacio").hide();
        t("#mensaje_validacion_mail").show();      
        return false;
    }

    t.ajax({     
              type  : "POST", 
              //url: 'validateUser.php?recuperar_contrasena=1&email=email',
              url: ruta+'validateUser.php?recuperar_contrasena=1&email=email',              
              data  : t("#form_recuperar_datos").serialize(),
              success: function(data) {  
                    //alert(data);
                    if(data==1){
                        t("#email").val('');
                        t("#mensaje_validacion_mail").hide();
                        t("#mensaje_validacion_vacio").hide();
                        t("#mensaje_error_password").hide(); 
                        t("#mensaje_envio_password").show();                          
                        return false;                       
                    }else{ 
                        t("#email").val('');  
                        t("#mensaje_validacion_mail").hide();
                        t("#mensaje_validacion_vacio").hide();
                        t("#mensaje_envio_password").hide();                                                                  
                        t("#mensaje_error_password").show();  
                        t("#email").focus();  
                        return false;
                    }   
              },
              beforeSend: function(objeto){                                          
              },
              complete: function(){                
              }
    });
    return false;
}

function validarRegistroUsuario(form) {    
    
    var nombre = form.nombre_sistema.value;  
    var apellido = form.apellido_sistema.value; 
    var telefono = form.telefono_sistema.value;  
    var documento = form.documento_sistema.value; 
    var email = form.email_sistema.value; 
    var password = form.password_sistema.value;
    var repetir_password = form.repetir_password_sistema.value;  
    var ruta=form.url.value;    
    var url_actividad=form.url_actividad.value;

    var emailRegex = /^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/;
    var telefonoRegex = /^[0-9]*t/;
    
    if (nombre == "") {        
        inlineMsg('nombre_sistema', 'Debe ingresar un nombre.', 2);
        return false;
    }     
    if (apellido == "") {
        inlineMsg('apellido_sistema', 'Debe ingresar un apellido.', 2);
        return false;
    } 
    if (telefono == "") {
        inlineMsg('telefono_sistema', 'Debe ingresar un telefono.', 2);
        return false;
    }
    if (!telefono.match(telefonoRegex)) {
        inlineMsg('telefono_sistema', 'Debe ingresar un telefono valido.', 2);
        return false;
    } 
    if (documento == "") {
        inlineMsg('documento_sistema', 'Debe ingresar un numero de documento.', 2);
        return false;
    }
    if (!documento.match(telefonoRegex)) {
        inlineMsg('documento_sistema', 'Debe ingresar un numero de documento valido.', 2);
        return false;
    }
    if (email == "") {
        inlineMsg('email_sistema', 'Debe ingresar un email.', 2);
        return false;
    }
    if (!email.match(emailRegex)) {
        inlineMsg('email_sistema', 'Debe ingresar un email valido.', 2);
        return false;
    }
    if (password == "") {
        inlineMsg('password_sistema', 'Debe ingresar un password.', 2);
        return false;
    }  
    if (repetir_password == "") {
        inlineMsg('repetir_password_sistema', 'Debe volver a ingresar su password.', 2);
        return false;
    } 
    if (password != repetir_password) {
        inlineMsg('repetir_password_sistema', 'Los passwords deben coincidir.', 2);
        return false;
    }       
    
    t.ajax({     
              type  : "POST", 
              url: ruta+'validateUser.php?registro_usuario_sistema=1',
              data  : t("#form_registrar_usuarios_sistema").serialize(),
              success: function(data) {  
                    
                    if(data==1){                   
                        //window.location.replace(ruta+"cuenta.php?cuenta=bienvenido"); 
                        window.location.replace(url_actividad+"/venta"); 
                    }else{                        
                        t("#nombre_sistema").val('');
                        t("#apellido_sistema").val('');  
                        t("#telefono_sistema").val('');
                        t("#documento_sistema").val('');                       
                        t("#email_sistema").val('');
                        t("#password_sistema").val('');  
                        t("#repetir_password_sistema").val('');                                            
                        t("#mensaje_usuario_existe_sistema").show();  
                        //t("#mensaje_usuario_existe_sistema").attr( "display", "block" );
                        t("#nombre_sistema").focus();  
                        return false;
                    }   
              },
              beforeSend: function(objeto){   
                                
              },
              complete: function(){                
              }
    });
    return false;
}

function validarRegistro(form) {
    
    var email = form.email.value;  
    var nombre = form.nombre.value;  
    var apellido = form.apellido.value;  
    var password = form.password.value;
    
    var emailRegex = /^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/;
    
    if (nombre == "") {
        t("#nombre").val('');        
        t("#mensaje_validacion_nombre").show();
        t("#nombre").focus();  
        return false;
    } 

    if (apellido == "") {
        t("#apellido").val('');  
        t("#mensaje_validacion_nombre").hide();      
        t("#mensaje_validacion_apellido").show();
        t("#apellido").focus(); 
        return false;
    } 

    if (email == "") {
        t("#email").val('');
        t("#mensaje_validacion_nombre").hide();
        t("#mensaje_validacion_apellido").hide();
        t("#mensaje_validacion_email").show();  
        t("#mensaje_validacion_email_invalido").hide(); 
        t("#email").focus();      
        return false;
    }

    if (!email.match(emailRegex)) {
        t("#email").val('');
        t("#mensaje_validacion_nombre").hide();
        t("#mensaje_validacion_apellido").hide();
        t("#mensaje_validacion_email").hide();  
        t("#mensaje_validacion_email_invalido").show();  
        t("#email").focus();     
        return false;
    }

    if (password == "") {
        t("#password").val('');    
        t("#mensaje_validacion_nombre").hide();
        t("#mensaje_validacion_apellido").hide(); 
        t("#mensaje_validacion_email").hide();  
        t("#mensaje_validacion_email_invalido").hide();   
        t("#mensaje_validacion_password").show();
        t("#password").focus(); 
        return false;
    }    
      
    t.ajax({     
              type  : "POST", 
              url: _url_+'validateUser.php?registro_usuario=1',
              data  : t("#form_registrar_usuarios").serialize(),
              success: function(data) {  
                    //alert(data);
                    if(data==1){
                        window.location.replace(_url_+"/cuenta.php?cuenta=bienvenido");                       
                    }else{                        
                        t("#nombre").val('');
                        t("#apellido").val('');  
                        t("#email").val('');
                        t("#password").val('');                                              
                        t("#mensaje_usuario_existe").show();  
                        t("#nombre").focus();  
                        return false;
                    }   
              },
              beforeSend: function(objeto){                               
              },
              complete: function(){                
              }
    });
    return false;
}

function validarRegistroComentario(form) {
    
    var email = form.email.value;  
    var nombre = form.nombre.value;  
    var apellido = form.apellidos.value;  
    var password = form.password.value;
    var url_actual = _url_+t("#url_page").val() + '#comment';
    var mensaje = t("#opinion").val();
    var url_page = t("#url_page").val()
    
    var emailRegex = /^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/;
    
    if (nombre == "") {        
        t("#notificacion_nombre").show();
        form.email.focus();  
        return false;
    } 

    if (apellido == "") {  
        t("#notificacion_nombre").hide();      
        t("#notificacion_apellidos").show();
        form.email.focus(); 
        return false;
    } 

    if (email == "") { 
        t("#notificacion_nombre").hide();
        t("#notificacion_apellidos").hide();
        t("#notificacion_email").show();  
        t("#notificacion_email_invalido").hide(); 
        t("#email").focus();      
        return false;
    }

    if (!email.match(emailRegex)) { 
        t("#notificacion_nombre").hide();
        t("#notificacion_apellidos").hide();
        t("#notificacion_email").hide();  
        t("#notificacion_email_invalido").show();  
        t("#email").focus();     
        return false;
    }

    if (password == "") { 
        t("#notificacion_nombre").hide();
        t("#notificacion_apellidos").hide(); 
        t("#notificacion_email").hide();  
        t("#notificacion_email_invalido").hide();   
        t("#notificacion_password").show();
        t("#password").focus(); 
        return false;
    }    
      
    t.ajax({     
        type  : "POST", 
        url: _url_+'validateUser.php',
        data  : t("#crearForm").serialize(),
        success: function(data){ 
              if(data != 0){  
                  usuario = data.split("-"); 
                  comentar(url_page, usuario[1],usuario[2],mensaje); 
                  window.location.replace(url_actual);                        
              }else{                        
                  t("#nombre").val('');
                  t("#apellido").val('');  
                  t("#email").val('');
                  t("#password").val('');                                              
                  t("#mensaje_usuario_existe").show();  
                  t("#nombre").focus();  
                  return false;
              }   
        },
        beforeSend: function(objeto){                               
        },
        complete: function(){                
        }
    });
    return false;
}

function lugaresController(tscope,thttp) {  
        
        //Cada vez que modifiquemos el contenido del campo de texto haremos una petición a nuestra base de datos con valores relacionados
        tscope.cargalugares = function(){
        thttp({url: "json.php", 
               method: "GET",
               params: {value: tscope.lugar}
        })
        .success(function(lugares) {
            tscope.lugares = lugares;
        });

        }

       //Cuando eliges un usuario lo reemplaza en el campo de texto
        tscope.cambialugar = function(lugar){  
        tscope.lugar = lugar;
        tscope.lugares = null;
        //alert('lugar: '+lugar);       
        var destino = lugar.replace(" ", "-");
        //alert('destino: '+destino);
        t(location).attr('href', _url_+'actividades&destino='+destino);
        }
}

function aventurerosController(tscope,thttp) {  
        
        //Cada vez que modifiquemos el contenido del campo de texto haremos una petición a nuestra base de datos con valores relacionados
        tscope.cargaAventureros = function(){
        thttp({url: "json.php", 
               method: "GET",
               params: {aventurero: tscope.aventurero}
        })
        .success(function(aventureros) {
            tscope.aventureros = aventureros;
        });

        }
        
        tscope.cambiaAventurero = function(aventurero,nombre){  
        
        tscope.aventurero = nombre;
        tscope.nombre = nombre;
        tscope.aventureros = null;
        var nombres = nombre.replace(" ","-");      
        var destino = aventurero+'-'+nombres;
        //alert('destino: '+destino);  //aventurero_121-Armando
        t(location).attr('href', _url_+'aventurero_'+destino);
        }
}

function aventureraController(tscope,thttp) {  
        
        //Cada vez que modifiquemos el contenido del campo de texto haremos una petición a nuestra base de datos con valores relacionados
        tscope.cargaAventura = function(){
        thttp({url: "json.php", 
               method: "GET",
               params: {aventura: tscope.aventura}
        })
        .success(function(aventuras) {
            tscope.aventuras = aventuras;
        });

        }
        
        tscope.cambiaAventura = function(ruta,titulo){  
        
        tscope.aventura = titulo; 
        tscope.ruta = ruta;       
        //tscope.aventura = null;
        //var nombres = nombre.replace(" ","-");      
        //var destino = aventurero+'-'+nombres;
        //alert('destino: '+titulo);  //aventurero_121-Armando
        t(location).attr('href', ruta);
        }
}

function comentar(url_page, id, nombre, mensaje){  
    var d = new Date();
    var days = ["Domingo","Lunes","Martes","Miercoles","Jueves","Viernes","Sabado"];
    var meses = ["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Setiembre","Octubre","Noviembre","Diciembre"];
    var fecha =  days[d.getDay()]+", "+d.getDate() + " de "+meses[d.getMonth()] + " del "+d.getFullYear();
    var icon_usuario = _url_+"aplication/webroot/imgs/usuario_logo.jpg";
    t.ajax({
            type:"POST",
            cache:false, 
            url: _url_+'ajax.php',//url: 'responsableInscripciones.php',
            data  :{mensaje:mensaje,id:id, url_page:url_page}, 
            success: function(data) {   
                //alert(data)
              var item_comentario = "<div class='row fila-opinion'> <div class='col-md-1 col-sm-2 col-xs-2' style='padding:0px;text-aling:center'><img class='img-circle' src='"+icon_usuario+"'?width=70&height=70'/></div>"
              + "<div class='col-md-11 col-sm-10 col-xs-10 comentario-deaventura'> <div class='opinion-persona'> "
              + "<h5>"+nombre+"</h5>"
              + "<p>"+mensaje+"</p><span class='fecha'>"+fecha+"</span></div></div></div>";
              t("#comentarios-inputs").append(item_comentario);
              t("#opinion").val("");
              t(".close").click();
            }
    });          
    
}
/***  Class App*/
function AppF (fbAppId) {
    var self = this;
    
    this.name = 'MiApp',
    this.facebook = {
        appId :fbAppId    
    },
    this.other,
    
    /*
     * Get ID App FB
     * @returns String {App.fbAppId}
     */
    this.getAppIdFacebook = function() {
        return this.facebook.appId;
    },
    
    /**
     * Init app in page.html only include call this function
     */
    this.initAppFacebook = function() {
        createDivFb();
        //initializing API
        window.fbAsyncInit = function() { console.log('INIT FB');
            FB.init({
                appId: self.getAppIdFacebook(),
                status: true,
                cookie: true,
                xfbml: true,
    		version : 'v2.9' 
    		});
        };
        (function() {
            var e = document.createElement('script'); e.async = true;
            e.src = document.location.protocol +
                '//connect.facebook.net/es_LA/all.js';
            document.getElementById('fb-root').appendChild(e);
        }());
        
        // helper
        function createDivFb() {
            var element = document.getElementById('fb-root');
            if (element == null) {
                var iDiv = document.createElement('div');
                iDiv.id = 'fb-root';
                document.getElementsByTagName('body')[0].appendChild(iDiv);
            }
        }
    }
}

/*** Init App */ //var App = new App('244715988912141'); // PRODUCTION
var AppF = new AppF('466105603427618');

function login(ingreso) { /* solo esto es para el logueo con facebook, el response es el que te devuelve si es valido o no el logueo */
    LodingAnimate();
    FB.login(function(response){ 
        if (response.status == 'connected') {
        
         
	    //console.log('Bienvenido!  Fetching your information.... ');
	    FB.api('/me', function(response) {
	       
	     
	      document.getElementById('welcome_b').innerHTML =
	        'Gracias por Loguearte, ' + response.name + '!';
	      AjaxResponse(ingreso,response); 
	        
	    });  
        } else {
            alert("No se pudo identificar al usuario");
            ResetAnimate();
        }
    }, {
        scope: 'email,publish_stream'
    }); 
}

function AjaxResponse(ingreso,respuesta) {
    var URLactual = window.location;
    //alert('URLactual: '+URLactual); 
    var Mdata=''; 
    var myData = 'connect=1'; //For demo, we will pass a post variable, Check process_facebook.php
    jQuery.ajax({
        type: "POST",
        url: _url_+"validateUser.php",
        dataType: "html",
        data: {connect:'1',nombre:respuesta.first_name,apellidos:respuesta.last_name,email:respuesta.email,idFB:respuesta.id,edad:respuesta.age_range,sexo:respuesta.gender,link:respuesta.link},
	headers: { 
	      'Content-Type':'application/x-www-form-urlencoded'
	},        
	   success: function(response){
            console.log('response', response); 
            var respuesta_ajax=response.split("-");
            t("#welcome_b").html(respuesta_ajax[1]); //Result
            if (response == 'false'){
                var message = "La applicación requiere datos basicos : (email, fecha de cumpleaños) \n"
                    + "Verifique su cuenta de Facebook, para poder acceder.";
                alert(message);
            }else{               
                if(ingreso == '1'){ //
                    var usuario=respuesta_ajax[1].split(",");    
                    if(usuario[0]=='bienvenido'){
                        window.location.replace(_url_+"/cuenta.php?cuenta=bienvenido");
                    }else{
                        window.location.replace(URLactual);
                    }
                }else if(ingreso =='2'){
                    if(response != 0){  
                        var usuario = respuesta_ajax[1].split(",");
                        var url_actual = _url_+t("#url_page").val() + '#comment';
                        var mensaje = t("#opinion").val();
                        var url_page = t("#url_page").val();
                        var nombre = usuario[1];
                        var id = respuesta_ajax[0];
                        comentar(url_page,id,nombre,mensaje); 
                        window.location.reload(url_actual);                        
                    }
                }else{
                    window.location.replace(ingreso);
                }               
                //window.location.replace("/cuenta.php?cuenta=bienvenido");                
            }
            /*
            if (response == 'false') {
                var message = "La applicación requiere datos basicos : (email, fecha de cumpleaños) \n"
                    + "Verifique su cuenta de Facebook, para poder acceder.";
                alert(message);
            } else {
                window.location.replace("/cuenta.php?cuenta=bienvenido");
            }
            */
        },
        error: function(xhr, ajaxOptions, thrownError) {
            t("#welcome_b").html(thrownError); //Error
        }
    });
}

function LodingAnimate() { t( "#login" ).append(' <span id="welcome_b"> <img src="aplication/webroot/imgs/ajax-loader.gif" /></span> '); }

function ResetAnimate() { t("#welcome_b").remove(); }
/*** Ready */
$(document).ready(function() {

    $("#departamento").change(function(){       
        $("#departamento option:selected").each(function () {
            departamento = $(this).val(); 
            $.post("ajax.php",{seccion: 'ubigeo',action:'Provincias', id: departamento }, function(data){           
                $(".provincia").slideDown(250);                             
                $("#distrito").html("<option>Seleccione un distrito ...</option>"); 
                $("#provincia").children().remove();
                $("#provincia").append('<option value="">Seleccione una provincia ...</option>');
                $.each(data, function(i, item) {
                    $("#provincia").append('<option value="'+item.codprov+'">'+item.nombre+'</option>')
                });

            },'json');

        });
    }); 

    $list = $("#list_item");
    if ($list.length != 0) {
        $list.sortable();
        $list.disableSelection();
    }
    
    $(".delete_step").click(function() {

        var $this = $(this);
        var idx = $this.find(".id_delete").val();
        if (idx == undefined) {
            $this.parent().remove();
        } else {
            $.post("ajax.php", {
                nombre_image: idx
            }, function(data) {
                $this.parent().remove();
            })
        }
    });
    
    $(".panel_comparte .delete").click(function() {
        var $this = $(this);
        $this.css({
            'cursor': 'wait'
        });
        var idx = $this.find(".id_delete").val();
        if (idx == undefined) {
            $this.parent().remove();
        } else {
            $.post("ajax.php", {
                id_image: idx
            }, function(data) {
                //$this.parent().slideDown();
                $this.parent().remove();
                //$("#cbo_deportes").append(data);
            })
        }
    });

    $(".custom-input-file input:file").change(function() {
        $(".archivo").html($(this).val());
    });
    if($( ".date" ).length>0){
        $( ".date" ).datepicker({ 
            dateFormat: 'd-m-Y' 
        });
    }
    $(".eliminar").click(function(){
        if(!confirm("Desea realmente eliminar este Evento")){
                return false;
        }
    });
       
    $(".delete_actividad").click(function() {
        $this = $(this);
        if (confirm("¿Seguro que quiere eliminar la actividad ?")) {
            var tipo = $this.data('tipo') // Extraer la información de atributos de datos
            var id = $this.data('id')
            var url = "cuenta.php?actividades="+tipo+"&action=del&id="+id;
            window.location.replace(url);
        }
        return false;
    });
    
    $(window).scroll(function() {
        if ($(this).scrollTop() != 0) {
            $('#scroll').fadeIn();
        } else {
            $('#scroll').fadeOut();
        }
    });

    $('#scroll').click(function() {
        $('body,html').stop().animate({
            scrollTop: 0
        }, 200);
        return false;
    });
    
    /*---Metodo relleno de DIVS---*/
    var total_tipos = $("#cuerpo .pnl").length;
    var div_tipo1 = $("#cuerpo .panel1").length;
    var div_tipo2 = $("#cuerpo .panel2").length;
    var res = div_tipo2 + div_tipo1 * 2;

    var action;
    if ($('#login').length != 0) {
        action = "javascript: login();";
    } else if ($('#logout').length != 0) {
        action = "cuenta.php?cuenta=compartir";
    }
    if (total_tipos % 2 != 0) { // por ahora no
        // $('<a href="' + action + '" class="panel_ingresa"><p>INGRESA AQUÍ</p><p>TU HISTORIA DE AVENTURA</p></a>').insertAfter("#cuerpo .pnl:last");
    }

    /*----Menu----*/
    $("#menu ul li").each(function(i, e) {
        var rel = $("#menu ul li").eq(i).find("a").attr("rel");

        var image = new Image();
        image.src = 'aplication/webroot/imgs/catalogo/' + rel + '.png';
        image.onload = function() {
            $("#menu ul li").eq(i).find("a").prepend('<p><img src="' + image.src + '" width="24" height="23"/></p>');
        }

        var image2 = new Image();
        image2.src = 'aplication/webroot/imgs/catalogo/' + rel + '_hover.png';
        image2.onload = function() {
            $("#menu ul li").eq(i).find("a").prepend('<img class="img_hover" src="' + image2.src + '" />');

        }

    });

    $("#menu ul li a").hover(function() {
        if (!$(this).parent().hasClass("active")) {
            $(this).find(".img_hover").stop(true, true).show().animate({
                'top': '-11px',
                'opacity': 1
            }, 300);
            $(this).find("img:not(.img_hover)").css({
                'opacity': 0
            });
        }
    }, function() {
        if (!$(this).parent().hasClass("active")) {
            $(this).find("img:not(.img_hover)").css({
                'opacity': 1
            });
            $(this).find(".img_hover").hide().stop(true, true).animate({
                'top': '-6px'
            }, 400).fadeOut(400);
        }
    });

    /*--Panel right: Efecto de rutas y Eventos --*/
    $(".view_more").click(function() {
        if ($(this).text() == "+")
            $(this).text("-");
        else
            $(this).text("+");
        $(this).siblings("ul").toggle(500);
    });

    /*--------------GALLERY----------------*/
    if ($("#showcase").length != 0) {
        $("#showcase").awShowcase({
            content_height: 540,
            fit_to_parent: true,
            auto: false,
            interval: 3000,
            continuous: true,
            loading: true,
            tooltip_width: 200,
            tooltip_icon_width: 32,
            tooltip_icon_height: 32,
            tooltip_offsetx: 18,
            tooltip_offsety: 0,
            arrows: true,
            buttons: false,
            btn_numbers: true,
            keybord_keys: true,
            mousetrace: false, /* Trace x and y coordinates for the mouse */
            pauseonover: true,
            stoponclick: true,
            transition: 'hslide', /* hslide/vslide/fade */
            transition_speed: 500,
            transition_delay: 300,
            show_caption: 'onhover', /* onload/onhover/show */
            thumbnails: false,
            thumbnails_position: 'outside-last', /* outside-last/outside-first/inside-last/inside-first */
            thumbnails_direction: 'horizontal', /* vertical/horizontal */
            thumbnails_slidex: 0, /* 0 = auto / 1 = slide one thumbnail / 2 = slide two thumbnails / etc. */
            dynamic_height: false, /* For dynamic height to work in webkit you need to set the width and height of images in the source. Usually works to only set the dimension of the first slide in the showcase. */
            speed_change: false, /* Set to true to prevent users from swithing more then one slide at once. */
            viewline: true /* If set to true content_width, thumbnails, transition and dynamic_height will be disabled. As for dynamic height you need to set the width and height of images in the source. It's OK with only the width. */
        });
    }

    /*------- CREACION DE UNA AVENTURA -------------*/
    var id_aventura = $("#id_aventura").val();
    if ($("#cbo_deportes").length !== 0 && !id_aventura) {
        $.post("ajax.php", {
            deportes: '1'
        }, function(data) {
            if (data != "") {
                $("#cbo_deportes").append(data);
            }
            var indexSelect = $("#cbo_deportes").attr('data-indexSelected');
            if (typeof(indexSelect) != 'undefined' ) {
                $("#cbo_deportes").val(indexSelect);
            }
        });
        // select if exist param

        /*Cbo deporte*/
        $("#cbo_deportes").change(function() {

            $.post("ajax.php", {
                idCbo: $(this).val()
            }, function(data) {
                if (data != "" && data.length > 3) {
                    $("#cbo_modalidad").html(data);
                } else {
                    $("#cbo_modalidad").html('<option value="0">No disponible</option>');
                }
            });
            
            // change cbo agencias
            $.post("ajax.php", {
                agencias: '1', idDeporte : $(this).val()
            }, function(data) {
                if (data != "" && data.length > 3) {
                    $("#cbo_agencias").html('<option value="">Elegir Agencia ...</option>');
                    $("#cbo_agencias").append(data);
                } else {
                    $("#cbo_agencias").html('<option value="">No disponible</option>');
                }              
            });            
        });



        /*Cbo*/

        // load combobox agencias
        if ($("#cbo_agencias").length !== 0 && $("#cbo_deportes").val() > 0) {
            // select if exist param
            var indexSelect = $("#cbo_deportes").attr('data-indexSelected');
            $.post("ajax.php", {
                agencias: '1', idDeporte : indexSelect
            }, function(data) {
                if (data != "") {
                    $("#cbo_agencias").append(data);
                    // Select agencia
                    var indexSelectAgencia = $("#cbo_agencias").attr('data-indexSelected');
                    $("#cbo_agencias").val(indexSelectAgencia);
                }        
            });
        }
    }
    
    // load combox agengias
    if ($("#cbo_agencias").length !== 0 ) {
            var indexSelect = $("#cbo_deportes").attr('data-indexSelected');
            $.post("ajax.php", {
                agencias: '1', idDeporte : indexSelect
            }, function(data) {
                if (data != "") {
                    $("#cbo_agencias").append(data);
                    // Select agencia
                    var indexSelectAgencia = $("#cbo_agencias").attr('data-indexSelected');
                    $("#cbo_agencias").val(indexSelectAgencia);
                }           
            });
    }

    /* Subida de archivos*/
    /*Subir enlaces de videos - para campartir o modificar aventura*/
    var nvideo = 1;
    var myvideos = new Array();
    $("#btn_svideo").click(function() {
        $obj = $('#video_txt');
        url = $obj.val();
        var matches = url.match(/watch\?v=([a-zA-Z0-9\-_]+)/);
        if (matches) {
            var idPeli = url.split('?v=');
            if (idPeli[1] !== "") {
                myvideos.push(idPeli[1]);
                $(".fileupload-loading").show();
                $.get('https://gdata.youtube.com/feeds/api/videos/' + idPeli[1] + '?v=2&alt=json', function(data) {
                    title = data.entry.title.$t;
                    author = data.entry.author[0].name.$t;
                    mms = '<tr class="template-upload fade in" style="display: table-row;">';
                    mms += '<td><img src="aplication/webroot/imgs/icon_video.png"/></td>';
                    mms += '<td><p class="name">' + title + '<input type="hidden" name="video' + (nvideo++) + '" value="' + idPeli[1] + '"></p></td>';
                    mms += '<td width="240">Autor: ' + author + '</td>';
                    mms += '<td width="100"><button class="btn btn-warning cancel cvideo" title="Eliminar"></button></td>';
                    mms += '</tr>';
                    $("#table_imgs tbody").append(mms);
                    $(".fileupload-loading").hide();
                });
                $("#video_txt").val('');
            } else {
                alert("Debe introducir el link del video");
            }
        } else {
            alert('Url no válida');
            $obj.val('').focus();
        }
    });

    $("#table_imgs").delegate(".cvideo", "click", function() {
        $(this).parent().parent().fadeOut(function() {
            $(this).remove();
        });
    });



    //------------------------------------
    //Inicio del Jquery Plugin File upload
/**
* function for load images 
* - load images to create one aventura
 */
    if ($('.new_upload #fileupload').length !== 0) {
        $('#fileupload').fileupload({
            // Uncomment the following to send cross-domain cookies:
            //xhrFields: {withCredentials: true},
            url: 'aplication/utilities/fileUpload/server/',
            disableImageResize: /Android(?!.*Chrome)|Opera/
            .test(window.navigator && navigator.userAgent),
            imageMaxHeight: 548,
            previewCrop: true
        });
        
        // Enable iframe cross-domain access via redirect option:

        var files_names = [];
        $('#fileupload').fileupload({
            maxFileSize: 10000000, // 10MB
            maxNumberOfFiles: 10,
            acceptFileTypes: /(\.|\/)(gif|jpe?g|png)$/i,
            process: [
                {
                    action: 'loadImage',
                    fileTypes: /^image\/(gif|jpeg|png)$/,
                    maxFileSize: 10000000 // 20MB
                },
                {
                    action: 'resizeImage',
                    maxHeight: 540,
                    imageCrop: true
                },
                {
                    action: 'saveImage'
                }
            ],

            done: function(e, data) { 
                // LOAD images of aventuras
                files_names.push(data.result.files[0].name);
            }
        });

        $('#fileupload').fileupload(
            'option',
            'redirect',
            window.location.href.replace(/\/[^\/]*$/, 'aplication/utilities/fileUpload/cors/result.html?%s')
        );

        $('#fileupload').bind('fileuploadstart', function(e) {
            $("body").css("cursor", "progress");
        })

        $('#fileupload').bind('fileuploadstop', function(e) {
            $.ajax({
                type: "POST",
                url: "ajax.php",
                data: "step=1" + "&" + "files=" + files_names.toString() + "&" + "videos=" + myvideos.toString() + "&" + $("#fileupload").serialize(),
                success: function(data) {
                    $("body").css("cursor", "default");
                    document.form_step1.submit();
                }
            });
        })
        
       
    }
    
    /* fin de creacion de imagenes de aventura */
    if ($('.new_upload_evento #fileupload_evento').length !== 0) {

        $('#fileupload_evento').fileupload({
            // Uncomment the following to send cross-domain cookies:
            //xhrFields: {withCredentials: true},
            url: 'aplication/utilities/fileUpload/server/',
            disableImageResize: /Android(?!.*Chrome)|Opera/
                    .test(window.navigator && navigator.userAgent),
            imageMaxHeight: 548,
            previewCrop: true
        });

        // Enable iframe cross-domain access via redirect option:
        var files_names = [];
        $('#fileupload_evento').fileupload({
            maxFileSize: 10000000, // 10MB
            maxNumberOfFiles: 10,
            acceptFileTypes: /(\.|\/)(gif|jpe?g|png)$/i,
            process: [
                {
                    action: 'loadImage',
                    fileTypes: /^image\/(gif|jpeg|png)$/,
                    maxFileSize: 10000000 // 20MB
                },

                {
                    action: 'resizeImage',
                    maxHeight: 540,
                    imageCrop: true
                },

                {
                    action: 'saveImage'
                }
            ],

            done: function(e, data) { 
                // LOAD images of aventuras
                files_names.push(data.result.files[0].name);
            }
        });
       
        $('#fileupload_evento').fileupload(
                'option',
                'redirect',
                window.location.href.replace(/\/[^\/]*$/, 'aplication/utilities/fileUpload/cors/result.html?%s')
                );

        $('#fileupload_evento').bind('fileuploadstart', function(e) {
            $("body").css("cursor", "progress");
        })
        $('#fileupload_evento').bind('fileuploadstop', function(e) {
            $.ajax({
                type: "POST",
                //url: "http://www.deaventura.pe/ajax2.php",
                url: "ajax.php",
                //data: "evento=1" + "&" + "files=" + files_names.toString() + "&" + "videos=" + myvideos.toString() + "&" + $("#form_datos_eventos").serialize(),
                data: "evento=1" + "&" + "files=" + files_names.toString() + "&" + "videos=" + myvideos.toString(),
                success: function(data) {
                    //alert('valor: '+data);                    
                    $("body").css("cursor", "default");
                    document.form_datos_eventos.submit();
                }
            });
        })
        /*
        $('#fileupload_evento').bind('fileuploadstop', function(e) {
            $.ajax({
                type: "POST",
                url: "ajax.php",
                data: "evento=1" + "&" + "files=" + files_names.toString() + "&" + "videos=" + myvideos.toString() + "&" + $("#form_datos_eventos").serialize(),
                success: function(data) {                    
                    $("body").css("cursor", "default");
                    document.form_datos_eventos.submit();
                }
            });
        })
        */
    }
 
    /*-------- INICIO MAPA DE SALIDAS GRUPALES  ---------*/
    if ($("#lat_posicion").length !== 0 && $("#lng_posicion").length !== 0) {
        var lat, lng;
        ($("#lat_posicion").val() === "") ? lat = -11.54932570 : lat = $("#lat_posicion").val();
        ($("#lng_posicion").val() === "") ? lng = -77.541503906 : lng = $("#lng_posicion").val();

        var myPos = new google.maps.LatLng(lat, lng);
        var mapOptions = {
            center: myPos,
            zoom: 12,
            mapTypeId: google.maps.MapTypeId.ROADMAP
        };

        var map = new google.maps.Map(document.getElementById('mi_ubicacion'), mapOptions);
        var input = (document.getElementById('address_salida'));
        var autocomplete = new google.maps.places.Autocomplete(input);

        autocomplete.bindTo('bounds', map);
        var infowindow = new google.maps.InfoWindow();
        var markerNew = new google.maps.Marker({
            map: map,
            draggable: true,
            icon: new google.maps.MarkerImage('aplication/webroot/imgs/icon_location.png'),
            position: new google.maps.LatLng(lat, lng)
        });

        google.maps.event.addListener(markerNew, 'mouseout', toggleBounce);
        google.maps.event.addListener(autocomplete, 'place_changed', function() {

            infowindow.close();
            markerNew.setVisible(false);
            //input.className = '';
            var place = autocomplete.getPlace();
            if (!place.geometry) {
                // Inform the user that the place was not found and return.
                input.className = 'notfound';
                return;
            }
            
            // If the place has a geometry, then present it on a map.
            if (place.geometry.viewport) {
                map.fitBounds(place.geometry.viewport);
            } else {
                map.setCenter(place.geometry.location);
                map.setZoom(17);  // Why 17? Because it looks good.
            }

            markerNew.setPosition(place.geometry.location);
            toggleBounce();
            markerNew.setVisible(true);
            var address = '';
            if (place.address_components) {
                address = [
                    (place.address_components[0] && place.address_components[0].short_name || ''),
                    (place.address_components[1] && place.address_components[1].short_name || ''),
                    (place.address_components[2] && place.address_components[2].short_name || '')
                ].join(' ');

            }

            infowindow.setContent('<div><strong>' + place.name + '</strong><br>' + address);
            infowindow.open(map, markerNew);

        });



        //Animación para seleccionar ubicación/
        google.maps.event.addListener(map, 'click', function(e) {
            placeMarker(e.latLng, map);
        });

        $("#address_salida").keypress(function(e) {
            if (e.keyCode == 13) {
                e.stopPropagation();
                return false;
            }
        });
    }
    /*-------- FIN MAPA DE SALIDAS GRUPALES  ---------*/ 

    /* seleccionar ubicacion en una aventura*/
    if ($("#lat_pos").length !== 0 && $("#lng_pos").length !== 0) {

        var lat, lng;
        ($("#lat_pos").val() === "") ? lat = -11.54932570 : lat = $("#lat_pos").val();
        ($("#lng_pos").val() === "") ? lng = -77.541503906 : lng = $("#lng_pos").val();

        var myPos = new google.maps.LatLng(lat, lng);
        var mapOptions = {
            center: myPos,
            zoom:12,
            mapTypeId: google.maps.MapTypeId.ROADMAP
        };
        
        var map = new google.maps.Map(document.getElementById('mi_ubic'), mapOptions);
        var input = /** @type {HTMLInputElement} */(document.getElementById('address'));
        var autocomplete = new google.maps.places.Autocomplete(input);

        autocomplete.bindTo('bounds', map);
        var infowindow = new google.maps.InfoWindow();
        var markerNew = new google.maps.Marker({

            map: map,
            draggable: true,
            icon: new google.maps.MarkerImage('aplication/webroot/imgs/icon_location.png'),
            position: new google.maps.LatLng(lat, lng)

        });

        google.maps.event.addListener(markerNew, 'mouseout', toggleBounce);
        google.maps.event.addListener(autocomplete, 'place_changed', function() {

            infowindow.close();
            markerNew.setVisible(false);
//            input.className = '';
            var place = autocomplete.getPlace();
            if (!place.geometry) {
                // Inform the user that the place was not found and return.
                input.className = 'notfound';
                return;
            }

            // If the place has a geometry, then present it on a map.
            if (place.geometry.viewport) {
                map.fitBounds(place.geometry.viewport);
            } else {
                map.setCenter(place.geometry.location);
                map.setZoom(17);  // Why 17? Because it looks good.
            }

            markerNew.setPosition(place.geometry.location);
            toggleBounce();
            markerNew.setVisible(true);

            var address = '';
            if (place.address_components) {
                address = [
                            (place.address_components[0] && place.address_components[0].short_name || ''),
                            (place.address_components[1] && place.address_components[1].short_name || ''),
                            (place.address_components[2] && place.address_components[2].short_name || '')
                ].join(' ');
            }
            infowindow.setContent('<div><strong>' + place.name + '</strong><br>' + address);
            infowindow.open(map, markerNew);
        });

        /*Animación para seleccionar ubicación*/
        google.maps.event.addListener(map, 'click', function(e) {
            placeMarker(e.latLng, map);
        });

        $("#address").keypress(function(e) {
            if (e.keyCode == 13) {
                e.stopPropagation();
                return false;
            }
        });
    }

    function placeMarker(position, map) {
        markerNew.setMap(null)
        markerNew.setMap(null);
        markerNew = new google.maps.Marker({
            map: map,
            draggable: true,
            icon: new google.maps.MarkerImage('aplication/webroot/imgs/icon_location.png'),
            position: position
        });

        google.maps.event.addListener(markerNew, 'mouseout', toggleBounce);//map.panTo(position); Efecto movimiento con el click
    }

    function toggleBounce() {
        //Capturo lo posicion al mover el icono del mapa
        var count = 0;
        $.each(markerNew.getPosition(), function(i, v) {
            if (count == 0) {//LB
                $("#lat_pos").val(v);
                $("#lat_posicion").val(v);
            } else if (count == 1) {//KB
                $("#lng_pos").val(v);
                $("#lng_posicion").val(v);
                return false;
            }
            count++;
        });
    }

    /*-------- INICIO DE MAPA DE ACTIVIDADES EVENTOS  ---------*/     
    if ($("#lat_pos_mapa").length !== 0 && $("#lng_pos_mapa").length !== 0) {
        var lat, lng;
        ($("#lat_pos_mapa").val() === "") ? lat = -11.54932570 : lat = $("#lat_pos_mapa").val();
        ($("#lng_pos_mapa").val() === "") ? lng = -77.541503906 : lng = $("#lng_pos_mapa").val();

        var myPos = new google.maps.LatLng(lat, lng);
        var mapOptions = {
            center: myPos,
            zoom: 12,
            //mapTypeId: google.maps.MapTypeId.ROADMAP
            mapTypeId: google.maps.MapTypeId.SATELLITE 
        };

        var map = new google.maps.Map(document.getElementById('mi_ubic_evento'), mapOptions);
        //inicio
          poly = new google.maps.Polyline({
          strokeColor: '#000000',
          strokeOpacity: 1.0,
          strokeWeight: 3
          });
          poly.setMap(map);

          // Add a listener for the click event
          map.addListener('click', addLatLng);
        //fin
        var input = /** @type {HTMLInputElement} */(document.getElementById('address'));
        var autocomplete = new google.maps.places.Autocomplete(input);
        autocomplete.bindTo('bounds', map);
        var infowindow = new google.maps.InfoWindow();        
        var markerNew = new google.maps.Marker({
            map: map,
            draggable: true,
            icon: new google.maps.MarkerImage('aplication/webroot/imgs/icon_location.png'),
            position: new google.maps.LatLng(lat, lng)
        });
        google.maps.event.addListener(markerNew, 'mouseout', toggleBounce);
        google.maps.event.addListener(autocomplete, 'place_changed', function() {
            infowindow.close();
            markerNew.setVisible(false);
//            input.className = '';
            var place = autocomplete.getPlace();
            if (!place.geometry) {
                // Inform the user that the place was not found and return.
                input.className = 'notfound';
                return;
            }
            // If the place has a geometry, then present it on a map.
            if (place.geometry.viewport) {
                map.fitBounds(place.geometry.viewport);
            } else {
                map.setCenter(place.geometry.location);
                map.setZoom(17);  // Why 17? Because it looks good.
            }
            markerNew.setPosition(place.geometry.location);
            toggleBounce();
            //markerNew.setVisible(true); //si usas autocompletado marca el lugar
            var address = '';
            if (place.address_components) {
                address = [
                    (place.address_components[0] && place.address_components[0].short_name || ''),
                    (place.address_components[1] && place.address_components[1].short_name || ''),
                    (place.address_components[2] && place.address_components[2].short_name || '')
                ].join(' ');
            }

            infowindow.setContent('<div><strong>' + place.name + '</strong><br>' + address);
            infowindow.open(map, markerNew); //si usas autocompletado marca la descripcion del lugar
        });
        var variableJs = new Array();    
        /*Animación para seleccionar ubicación*/
        google.maps.event.addListener(map, 'click', function(e) {  
            infowindow.close();          
            //alert('guardando la marca: '+e.latLng);
            /*** inicio test *******/
               var inicio = document.getElementById("incrementador").value; 
               if(inicio==0){ 
                 variableJs[inicio] = e.latLng;
                 //alert('variable del array inicial: '+variableJs[inicio]);
                 
                 for (var i = 0; i < variableJs.length; i++) {
                      //alert(variableJs[i]);
                 };
                 var intermedio=parseInt(inicio)+1;
                 document.getElementById("incrementador").value=intermedio;
                 
               }else{  
                 //alert('intermedio: '+inicio);
                 variableJs[inicio] = e.latLng ;
                 //alert('variable del array: '+variableJs[inicio]);
                  for (var i = 0; i < variableJs.length; i++) {
                      //alert(variableJs[i]);
                  };
                 var intermedio=parseInt(inicio)+1;
                 document.getElementById("incrementador").value=intermedio; 
               }  
               document.getElementById("coordenadas").value=variableJs; 
            /*** fin test *********/        
            placeMarkerEvento(e.latLng, map);
        });
        $("#address").keypress(function(e) {            
            if (e.keyCode == 13) {
                e.stopPropagation();
                return false;
            }
        });
    }   

    function addLatLng(event) {
      var path = poly.getPath();
      // Because path is an MVCArray, we can simply append a new coordinate
      // and it will automatically appear.
      path.push(event.latLng);
      // Add a new marker at the new plotted point on the polyline.
      var marker = new google.maps.Marker({
        position: event.latLng,
        title: '#' + path.getLength(),
        map: map
      });
    }    

    function placeMarkerEvento(position, map) {
        /*
        markerNew.setMap(null)
        markerNew.setMap(null);
        markerNew = new google.maps.Marker({
            map: map,
            draggable: true,
            icon: new google.maps.MarkerImage('aplication/webroot/imgs/icon_location.png'),
            position: position
        });
        google.maps.event.addListener(markerNew, 'mouseout', toggleBounce);//map.panTo(position); Efecto movimiento con el click
    */
    }
    /*----------- FIN DE MAPA DE ACTIVIDADES EVENTOS -----------*/

    /*-----------ELIMINAR AVENTURA--------------*/
    $(".elim_aventura").click(function() {
        $this = $(this);
        if (confirm("¿Seguro que quiere eliminar la aventura ?")) {
            var id = $this.find('input[type="hidden"]').val();
            $.post("ajax.php", {
                elim_av: '1',
                id: id
            }, function(data) {
                $this.parent().parent().remove();
                if ($(".aventura_panel").length == 0) {
                    $("#panel_step").append('<br/><div align="center">No tienes aventuras para mostrar</div>');
                }
            })
        }
        return false;
    });

    $(".elim_favoritos").click(function() {
        $this = $(this);
        if (confirm("¿Seguro que quiere eliminar la aventura de sus favoritos?")) {
            var id = $this.attr("rel");
            $.post("ajax.php", {
                elim_favorito: '1',
                id: id
            }, function(data) {
                $this.parent().parent().remove();
                if ($(".aventura_panel").length == 0) {
                    $("#panel_step").append('<br/><div align="center">Aún no tienes aventuras para  mostrar como favoritos</div>');
                }
            })
        }
        return false;
    });

    /*---------------------------------
     * -----crear y Modificar imagenes de una aventura---------
     * --------------------------------*/
    if ($("#form_update").length !== 0) {
        $('#form_update').fileupload({

            // Uncomment the following to send cross-domain cookies:
            //xhrFields: {withCredentials: true},

            url: 'aplication/utilities/fileUpload/server/',
            disableImageResize: /Android(?!.*Chrome)|Opera/
                    .test(window.navigator && navigator.userAgent),
            imageMaxHeight: 600,
            previewCrop: true

        });
        // Enable iframe cross-domain access via redirect option:
        $('#form_update').fileupload({
            maxFileSize: 10000000, // 10MB
            maxNumberOfFiles: 10,
            acceptFileTypes: /(\.|\/)(gif|jpe?g|png)$/i,
            process: [
                {
                    action: 'loadImage',
                    fileTypes: /^image\/(gif|jpeg|png)$/,
                    maxFileSize: 10000000 // 20MB
                },
                {
                    action: 'resizeImage',
                    maxHeight: 600,
                    imageCrop: true
                },
                {
                    action: 'saveImage'
                }
            ]
        });

        $('#form_update').fileupload(
            'option',
            'redirect',
            window.location.href.replace(/\/[^\/]*$/, 'aplication/utilities/fileUpload/cors/result.html?%s')
        );

        files_names = [];

        $('#form_update').bind('fileuploaddone', function(e, data) {

            files_names.push(data.result.files[0].name);
            var html = '';

            html += '<li>';
            html += '<div class="panel_comparte">';
            html += '<div class="delete_ajax"><input class="id_delete" type="hidden" value="' + data.result.files[0].name + '"></div>';
            html += '<div class="left_com"></div>';

            html += '<div class="img_block">';
            html += '<input name="id_files[]" type="hidden" value=""/>';
            html += '<input name="src_files[]" type="hidden" value="' + data.result.files[0].name + '"/>';
            html += '<input name="tipo_files[]" type="hidden" value="F"/>';
            html += '<div class="img_comparte"><img src="aplication/webroot/imgs/catalogo/aventuras_img_usuarios/' + data.result.files[0].name + '" width="171"></div>';
            html += '</div>';

            html += '<div class="descrp_comparte">';
            //html += '<div class="rowElem"><input name="descripcion_files[]" type="text" /></div>';
            html += '<div class="rowElem"><textarea name="titulo_files[]" placeholder="Describe tu foto (opcional)..."></textarea></div>';
            html += '</div>';
            html += '</div>';
            html += '</li>';
            
            if ($("#list_item li").length === 0) {
               $('#list_item').append(html);
            }else{
                $(html).insertAfter('#list_item li:last-child');
            }
            
            
            $.ajax({
                type: "POST",
                url: "ajax.php",
                data: "imagenMd=1" + "&" + "img=" + data.result.files[0].name,
                success: function(data) {
                    //alert(data);
                    $(".btn_guardar").css("display","inline-block");
                }
            });
            
        })

        $('#form_update').bind('fileuploadstop', function(e) {
            $("#table_imgs tbody tr").remove();
            $(".fileupload-progress").remove();
        })
         $(".btn-primary.start").click();
    }

    //INICIO MULTIMAGENES PARA EDITAR EVENTOS
    if ($('.actividades_patrocinadores #form_datos').length !== 0) { 
        
        $('.actividades_patrocinadores #form_datos').fileupload({
            url: 'aplication/utilities/fileUpload/server/',
            disableImageResize: /Android(?!.*Chrome)|Opera/
                    .test(window.navigator && navigator.userAgent),
            imageMaxHeight: 540,
            previewCrop: true
        });
        
        $('.actividades_patrocinadores #form_datos').fileupload({
            maxFileSize: 10000000, // 10MB
            maxNumberOfFiles: 10,
            acceptFileTypes: /(\.|\/)(gif|jpe?g|png)$/i,
            process: [
                {
                    action: 'loadImage',
                    fileTypes: /^image\/(gif|jpeg|png)$/,
                    maxFileSize: 10000000 // 20MB
                },
                {
                    action: 'resizeImage',
                    maxHeight: 540,
                    imageCrop: true
                },
                {
                    action: 'saveImage'
                }
            ]
        });

        $('.actividades_patrocinadores #form_datos').fileupload(
                'option',
                'redirect',
                window.location.href.replace(/\/[^\/]*$/, 'aplication/utilities/fileUpload/cors/result.html?%s')
                );
        files_names = [];

        $('.actividades_patrocinadores #form_datos').bind('fileuploaddone', function(e, data) {
            files_names.push(data.result.files[0].name);
            var html = '';
            html += '<li style="display:inline-block">';
            html += '<div class="panel_comparte">';
            html += '<div class="delete_ajax"><input class="id_delete" type="hidden" value="' + data.result.files[0].name + '"></div>';
            html += '<div class="img_block">';
            html += '<input name="id_files[]" type="hidden" value=""/>';
            html += '<input name="src_files[]" type="hidden" value="' + data.result.files[0].name + '"/>';
            html += '<input name="tipo_files[]" type="hidden" value="F"/>';
            html += '<div class="img_comparte"><img src="aplication/webroot/imgs/catalogo/aventuras_img_usuarios/' + data.result.files[0].name + '" width="171"></div>';
            html += '</div>'; 
            html += '</div>';
            html += '</li>';
            $(html).insertAfter('#list_item li:last-child');

            $.ajax({
                type: "POST",
                url: "ajax.php",
                data: "imagenMd=1" + "&" + "img=" + data.result.files[0].name,
                success: function(data) {
                    //alert(data);
                }
            });
        })

        $('.actividades_patrocinadores #form_datos').bind('fileuploadstop', function(e) {
            $("#table_imgs tbody tr").remove();
            $(".fileupload-progress").remove();
        })    
    }
    
    //FIN MULTIMAGENES PARA EDITAR EVENTOS
    // -----------------FIN the jQuery File Upload widget----------------------  
    $("#subir_archivos").click(function() {
        $(".btn-primary.start").click();
        /*Solo para los videos*/
        var arch = String(myvideos);
        var arr = arch.split(',');
        var html = '';
        if (myvideos.length > 0) {
            for (var i = 0; i < arr.length; i++) {
                html += '<div class="panel_comparte">';
                html += '<div class="delete"></div>';
                html += '<div class="left_com"></div>';
                html += '<div class="img_block">';
                html += '<input name="id_files[]" type="hidden" value=""/>';
                html += '<input name="src_files[]" type="hidden" value="' + arr[i] + '"/>';
                html += '<input name="tipo_files[]" type="hidden" value="V"/>';
                html += '<div class="img_comparte"><img src="aplication/webroot/imgs/icon_video_ver.jpg"></div>';
                html += '</div>';
                html += '<div class="descrp_comparte">';
                html += '<div class="rowElem"><input name="titulo_files[]" type="text" /></div>';
                html += '<div class="rowElem"><textarea name="descripcion_files[]"></textarea></div>';
                html += '</div>';
                html += '</div>';
            }
            $(html).insertBefore('#listado_archivos .clear');
            $('.ax-file-list .video_upload').remove();
        }

        myvideos = new Array();
        /*$("#table_imgs tbody tr").remove();
         $(".fileupload-progress").remove();*/

    });
 
    if ($(".panel_comparte .delete_ajax").length !== 0) {
        $(".panel_comparte .delete_ajax").live("click", function() {
            var $this = $(this);
            $this.css({
                'cursor': 'wait'
            });
            var idx = $this.find(".id_delete").val();
            $.post("ajax.php", {
                src_image: idx
            }, function(data) {
                $this.parent().remove();
            })
        });
    }

    /*-----------------Google Maps---------------------*/
    //Actualizar likes y commnets
    if ($("#cuerpo .pnl").length > 0) {
        var datos_av = $("#cuerpo .pnl");
        $(datos_av).each(function(index) {
            var $this = $(this);
            var url = $this.find('.titulo_panel a:first-child').attr("href");
            $.ajax({
                type: "GET",
                url: 'https://api.facebook.com/method/fql.query?query=SELECT%20like_count,comment_count,share_count,total_count%20FROM%20link_stat%20WHERE%20url=%22' + url + '%22',
                dataType: "xml",
                success: function(xml) {
                    $(xml).find('link_stat').each(function() {
                        var likes = $(this).find('like_count').text();
                        var comments = $(this).find('comment_count').text();
                        $this.find('.social_panel .coment').text(comments);
                        $this.find('.social_panel .like').text(likes);
                    });
                }
            });
        });
    }

    //AutoMArginTop - para sitios web por deporte
    $(".evento_desc").each(function(i) {
        var ha = parseInt($(".evento_desc").eq(i).height());
        var hb = parseInt($(".evento_desc").eq(i).find(".foto_panel_desc2").height());
        $(".evento_desc").eq(i).find(".foto_panel_desc2").css('margin-top', (ha / 2) - (hb / 2));
    });



    //Busqueda
    $("#nav_search li").click(function() {
        var rel = $(this).attr("rel");
        $(rel).show().siblings(".search_results").hide();
    });

    $("#btn_buscar").click(function(){  
        var texto = $("#busqueda").val();
        if(texto != "" ){
                texto = texto.replace(/(\s)/gi,"-");
                busqueda(_url_,texto);
        }       
    });
    
    function busqueda(url,texto){
        document.fbuscar.action = url+'q=' + texto;
        document.fbuscar.submit();
    }

    /*--------------Ver Aventura--------------*/
    if ($(".aventura-info").length !== 0) {
        var url = document.URL;
        var uid = $(".aventura-info").attr("uid-av"); //ID de la aventura
        window.fbAsyncInit = function() {
            FB.init({
                appId: '244715988912141',
                status: true,
                cookie: true,
                xfbml: true,
                oauth: true
            });
            FB.Event.subscribe('edge.create', function(response) {
                var pp = parseInt($(".like").text());
                $(".like").text(pp + 1);
                data_facebook(url, uid, "likes");
            });
            FB.Event.subscribe('edge.remove', function(response) {
                var pp = parseInt($(".like").text());
                $(".like").text(pp - 1);
                data_facebook(url, uid, "likes");
            });
            FB.Event.subscribe('comment.create', function(response) {
                var pp = parseInt($(".coment").text());
                $(".coment").text(pp + 1);
                data_facebook(url, uid, "coments");
            });
            FB.Event.subscribe('comment.remove', function(response) {
                var pp = parseInt($(".coment").text());
                $(".coment").text(pp - 1);
                data_facebook(url, uid, "coments");
            });
        }
        //data_facebook(url, uid, "all");
    }

    /*jQuery(function($){
        $.datepicker.regional['es-PE'] = {
            closeText: 'Cerrar',
            prevText: '&#x3c;Ant',
            nextText: 'Sig&#x3e;',
            currentText: 'Hoy',
            monthNames: ['Enero','Febrero','Marzo','Abril','Mayo','Junio',
            'Julio','Agosto','Septiembre','Octubre','Noviembre','Diciembre'],
            monthNamesShort: ['Ene','Feb','Mar','Abr','May','Jun',
            'Jul','Ago','Sep','Oct','Nov','Dic'],
            dayNames: ['Domingo','Lunes','Martes','Mi&eacute;rcoles','Jueves','Viernes','S&aacute;bado'],
            dayNamesShort: ['Dom','Lun','Mar','Mi&eacute;','Juv','Vie','S&aacute;b'],
            dayNamesMin: ['Do','Lu','Ma','Mi','Ju','Vi','S&aacute;'],
            weekHeader: 'Sm',
            dateFormat: 'dd/mm/yy',
            firstDay: 0,
            isRTL: false,
            showMonthAfterYear: false,
            yearSuffix: ''};
        $.datepicker.setDefaults($.datepicker.regional['es-PE']);
    });*/
    

});

function data_facebook(url, id, tipo) {
    var likes, comments;
    $.ajax({
        type: "GET",
        url: 'https://api.facebook.com/method/fql.query?query=SELECT%20like_count,comment_count,share_count,total_count%20FROM%20link_stat%20WHERE%20url=%22' + url + '%22',
        dataType: "xml",
        success: function(xml) {
            $(xml).find('link_stat').each(function() {
                likes = $(this).find('like_count').text();
                comments = $(this).find('comment_count').text();
                $(".like").text(likes);
                $(".coment").text(comments);
            });
        },

        complete: function() {
            $.ajax({
                type: "POST",
                url: 'ajax.php',
                data: {
                    type: tipo,
                    id: id,
                    likes: likes,
                    comments: comments,
                    updateFace: '1'
                }
            });
        }
    });
}

/*---------------------More Scroll Content------------------*/
$(window).scroll(function() {

    if ($(window).scrollTop() === $(document).height() - $(window).height()) {
        $content = $("#seccion-right");
        $loadMore = $("#loadMoreContent");

        if ($loadMore.lenght !== 0) {
            //Agregar o quitar la clase active del PADRE para que solo se ejecute una vez
            //La comprobación de mpás contenido
            if ($content.hasClass('active')) {
                return false;
            } else {
                $content.addClass("active");
            }

            $loadMore.show(); 
            $.ajax({
                url: "ajax.php",
                type: "POST",
                data: {
                    id: $(".pnl.panel2:last").attr('id'),
                    action: 'loadMore',
                    type: $content.attr("post-type"),
                    uid: $content.attr("post-id")
                },

                success: function(html) {
                    if (html && html != 0){
                        $(html).insertBefore('#loadMoreContent');
                        $loadMore.hide();
                        $content.removeClass("active");
                    } else {
                        $loadMore.remove();
                    }
                }
            });
        }
    }
});

/*...............*/
function agregarfavoritos(aventura) {

    $(".add_favoritos").css({
        'background': 'url('+_url_+'aplication/webroot/imgs/ajax-loader.gif) no-repeat'
    });

    $.post(_url_+"ajax.php", {
        favoritos: '1',
        id: aventura
    }, function(data) {
        console.log(data);
        $(".add_favoritos").css({
            'background': 'url('+_url_+'aplication/webroot/imgs/icon_favoritos.png) no-repeat 0px -20px'
        });
        $(".add_favoritos").addClass("active").removeAttr("onclick");
    })
}

function btn_eventos(evento) {//Asistiré, estuve aqui
    $.post(_url_+"ajax.php", {
        mod_evento: '0',
        id: evento
    }, function(data) {
        if (data == 0) {
            alert("Debe iniciar sesión para poder realizar esta acción");
        } else if (data == 1) {
            alert("El evento ya está registrado");
        } else {
            $(".abtn_evento").removeAttr("onclick").addClass('active');
            $(".abtn_evento").html('<a id="cancel_evento" href="javascript: cancel_evento(' + evento + ');"></a>');
        }
    })
}

function cancel_evento(evento) {
    $.post(_url_+"ajax.php", {
        mod_evento: '1',
        id: evento
    }, function(data) {
        $(".abtn_evento").removeClass("active")
                .attr("onclick", "javascript: btn_eventos(" + evento + ")")
                .find("a").remove();
    });
    return false;
}

function abrir_detalle (id_actividad,id_venta) {
  
  $("#abrir_detalle_"+id_venta).css('display','none');
  $("#cerrar_detalle_"+id_venta).css('display','block');  
  $("#add_detalle_"+id_venta).show('slow'); //id_venta='+id_venta 
  
    $.ajax({              
          //url: 'inscripciones_detalle.php?id_actividad='+id_actividad+'&id_venta='id_venta, 
          url: 'inscripciones_detalle.php?id_actividad='+id_actividad+'&id_venta='+id_venta,
          success: function(data) {  
            $("#add_detalle_"+id_venta).html(data);               
          },     
          beforeSend: function(objeto){ 
          },
          complete: function(){
          }
    });
    
}

function buscador_categoria(form) {
  //var buscador=form.buscador.value; 
  //window.location.replace("q="+buscador);
  var ruta=$("#ruta").val();
  //alert(ruta); 
  
  var buscador_texto=form.buscador.value; 
  var buscador_array=buscador_texto.split(" ");
  var buscador=buscador_array.join("-");
  //alert(buscador); 
  
  window.location.replace(ruta+"q="+buscador);  
  //window.location.replace(ruta);  
}

function cerrar_menu (id_venta) {
    $("#abrir_detalle_"+id_venta).css('display','block');
    $("#cerrar_detalle_"+id_venta).css('display','none');
    $("#add_detalle_"+id_venta).css('display','none');
}

/*IGUAL COLUMNAS DIV VARIADO EN ALTO*/
/*RECORRIDO COLUMNAS DE DIV: CAPTURA EL ALTO MAYOR Y AUTOMATICAMENTE SE PONE A TODOS LOS DIV
ESO AYUDA PARA ALTO VARIANTES DE DIV*/
function equalHeight(group){
    tallest = 0;
    if (group!=null) {
        group.each(function() {
          thisHeight = $(this).height();
          if(thisHeight > tallest) {
                 tallest = thisHeight;
          }
        });
         group.height(tallest); 
    };             
}

